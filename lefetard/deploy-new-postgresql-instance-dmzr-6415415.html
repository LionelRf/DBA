<!DOCTYPE html>
<!--[if lte IE 6]><html class="ie6 ie67 ie678" lang="fr"><![endif]-->
<!--[if IE 7]><html class="ie7 ie67 ie678" lang="fr"><![endif]-->
<!--[if IE 8]><html class="ie8 ie678" lang="fr"><![endif]-->
<!--[if IE 9]><html class="ie9" lang="fr"><![endif]-->
<!--[if (gt IE 9)|!(IE)]<!--><html lang="fr"><!--<![endif]-->
<head>
<meta charset="UTF-8"/>
<title>Deploy new postgreSQL instance dMZR - The Best of DBA</title>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<meta name="description" content="Deploy new postgreSQL instance dMZR"/>
<meta name="keywords" content="Oracle, Postgresql, Sqlserver, MySQL, database, RMAN, Cassandra"/>
<meta name="robots" content="index,follow"/>
<meta property="og:title" content="Deploy new postgreSQL instance dMZR - The Best of DBA"/>
<meta property="og:description" content="Deploy new postgreSQL instance dMZR"/>
<meta property="og:image" content=""/>
<link rel="stylesheet" href="025395.css"/>
<link rel="stylesheet" href="style.css?1722328855"/>
<!--[if (gt IE 8)|!(IE)]<!-->
<link href="https://fonts.googleapis.com/css?family=Noto+Serif:400,400italic,700,700italic|" rel="stylesheet"/>
<!--<![endif]-->
<!--[if lte IE 8]>
<link href="https://fonts.googleapis.com/css?family=Noto+Serif:400" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css?family=Noto+Serif:400italic" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css?family=Noto+Serif:700" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css?family=Noto+Serif:700italic" rel="stylesheet"/>
<![endif]-->
<link rel="stylesheet" href="font-awesome.min.css"/>
<!--[if IE 7]><link rel="stylesheet" href="https://static.hautetfort.com/backend/css/font/font-awesome-ie7.min.css"/><![endif]--><link rel="shortcut icon" href="favicon.ico"/>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://www.hautetfort.com/admin/rsd/71687"/>
<link rel="start" href="index-0.html" title="Home"/>
<link rel="canonical" href="deploy-new-postgresql-instance-dmzr-6415415.html"/>
<link rel="prev" href="modifier-l-encodage-postgresql-en-utf8-6339378.html" title="Modifier l'encodage PostgreSQL en UTF8"/><link rel="next" href="postgresql-compress-6375737.html" title="[PostgreSQL] COMPRESS"/><!--[if lt IE 9]><script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
<!-- start script --><!-- end script -->
<script type="text/javascript">

function popupCenter(url,width,height,xtr) {
    var top=(screen.height-height)/2;
    var left=(screen.width-width)/2;
    window.open(url,"",xtr+",top="+top+",left="+left+",width="+width+",height="+height);
}

</script>

    <style type="text/css">
body {
    margin-bottom: 0px;
}
#toppub { display: block; width: 555px; height: 140px; margin: 0 auto;}
.content a img {border:0px;}
#footer {
    text-align: center;
    font-size: 65%;
    width: auto;
    margin: 2em auto 0px auto;
    color: #000;
    line-height: 210%;
    display: block;

    padding: 15px 15px 35px ;
    background: #fff url("hetf-background.png") no-repeat 45% 10%;
    border-top: 3px solid #D20000;
        
}
#footer a {
    color: #000;
    text-decoration: underline;
    background-color: transparent;
    display: inline;
}
#footer a:hover {
    color: #000;
    text-decoration: underline;
    background-color: transparent;
    display: inline;
}
#sponsored-links {
    display: block;
    margin: 0;
    padding: 0;
    border: 0;
    background: transparent;
    margin-bottom: -5px;
}
</style>

</head><body id="page-permalink" itemscope="itemscope" itemtype="http://schema.org/WebPage">
<div data-cookie="off"><p data-close><a href="deploy-new-postgresql-instance-dmzr-6415415.html#" title="J'ai lu ce message"><span class="ui-icon ui-icon-check">Ok</span></a></p><p data-text>En poursuivant votre navigation sur ce site, vous acceptez l'utilisation de cookies. Ces derniers assurent le bon fonctionnement de nos services. <a href="https://www.hautetfort.com/cookies.html" title="En savoir plus sur les cookies" target="_blank">En savoir plus</a>.</p></div><style>[data-cookie]{display:none;position:fixed;backface-visibility:hidden;bottom:0;left:0;width:100%;background:black;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQIW2NkYGDYDAAAvQC1UcyxoAAAAABJRU5ErkJggg==);color:white;padding:.5em 0;text-align:center;z-index:9999;}
[data-cookie~="on"]{display:block;}
[data-cookie] p{color:white;font-size:12px;margin:0;padding:0 .5em;line-height:1.3em;text-shadow:1px 0 3px rgba(0,0,0,1);}
[data-cookie] a{color:white;}
[data-cookie] [data-text]{margin:1px auto 0;text-align:left;max-width:980px;}
[data-cookie] [data-close]{float:right;margin:0 .5em;}
[data-cookie] .ui-icon{background-image: url(http://download.jqueryui.com/themeroller/images/ui-icons_ffffff_256x240.png);}
.ui-icon-check {background-position: -64px -144px;}
.ui-icon {height: 16px;width: 16px;}
.ui-icon {background-repeat: no-repeat;display: block;overflow: hidden;text-indent: -99999px;}
@media print {[data-cookie]{display:none;}}
</style>
<div class="wrapper">
<div class="container">
<!--[if lte IE 7><p class="alert">Votre navigateur est <strong>périmé</strong>. <a href="http://browsehappy.com/" target="_blank">Veuillez mettre votre navigateur à jour.</a></p><![endif]-->
<a href="deploy-new-postgresql-instance-dmzr-6415415.html#content" class="skip-link" accesskey="s">Aller au contenu</a>
<header class="header-main" role="banner" itemscope="itemscope" itemtype="http://schema.org/WPHeader">
<div class="main-inner">
<!-- start top --><div class="row-fluid"><div class="span9"><!-- widget heading on -->
<div class="box box-heading" id="box-heading-101343">
<div class="box-header">
<h1><a href="index-0.html">The Best of DBA</a></h1>
</div>
<div class="box-body">
<h2>Maîtriser les bases de données, maximiser les performances.</h2>
</div>
</div>
<!-- widget heading off --></div></div><div class="row-fluid"><div class="span12"><!-- widget menu on -->
<div role="navigation" class="box box-menu box-menu-sticky" id="box-menu-101345">
<div class="box-body">
<span class="menu-switcher" id="display-navigation"><i class="icon icon-reorder"></i></span><nav role="navigation" id="navigation-to-display">
<ul role="menu">
<li role="menuitem"><a href="index-0.html">Accueil</a></li>
<li class="masked-on-mobile" role="menuitem"><a href="archives">Archives</a></li>
<li role="menuitem"><a href="about.html">À propos</a></li>
<li class="revealed-on-mobile" role="menuitem" tabindex="-1"><a href="index-0.html">Notes</a></li>
<li class="revealed-on-mobile" role="menuitem" tabindex="-1"><a href="archives#archive-categories">Catégories</a></li><li class="revealed-on-mobile" role="menuitem" tabindex="-1"><a href="archives#archive-months">Archives</a></li>
</ul>
</nav>
</div>
</div>
<!-- widget menu off --></div></div><!-- end top --></div>
</header>
<div class="body-main" role="main">
<div class="main-inner">
<div class="row-fluid">
<div class="span4">
<aside role="complementary" class="aside aside-1" itemscope="itemscope" itemtype="http://schema.org/WPSideBar">
<!-- start column 1 --><!-- widget search on -->
<article class="box box-search" id="box-search-101337">
<header class="box-header">
<h1><i class="icon icon-search"></i><span class="box-title-text">Rechercher</span></h1>
</header>
<div class="box-body">
<form class="form-search" name="form-box-search-101337" id="form-box-search-101337" role="search" method="get" action="http://lefetard.hautetfort.com/apps/search">
<p class="form-submit">
<span class="row-fluid">
<span class="span10">
<span class="form-field">
<input name="s" id="search-field-box-search-101337" type="search" placeholder="Entrer votre recherche" required="required"/>
<label class="error" for="search-field-box-search-101337" style="display:none"></label>
</span>
</span>
<span class="span2">
<span class="form-button">
<input name="search-submit-box-search-101337" id="search-submit-box-search-101337" class="button" type="submit" value="OK"/>
</span>
</span>
</span>
</p>
</form>
</div>
</article>
<!-- widget search off --><!-- widget list on -->
<article class="box box-list box-list-document" id="box-list-457254">
<header class="box-header">
<h1><i class="icon icon-ellipsis-vertical"></i><span class="box-title-text">CV</span></h1>
</header>
<div class="box-body">
<ul role="list" class="lists-list">
<li role="listitem">
<a href="dba-freelance.html">
<span>DBA Freelance</span>
</a>
</li>
</ul>
</div>
</article>
<!-- widget list off --><!-- widget about on -->
<article class="box box-about" id="box-about-101313">
<header class="box-header">
<h1><i class="icon icon-info-sign"></i><span class="box-title-text">À propos</span></h1>
</header>
<div class="box-body">
<p class="description" itemscope="itemscope" itemtype="http://schema.org/AboutPage">
<span itemprop="description">  - Dynamique, rigoureux, pédagogue, à l'écoute des besoins de mes clients ;...</span>
<a href="about.html" itemprop="url">
Lire la suite</a>
</p>
</div>
</article>
<!-- widget about off --><!-- widget authors on -->
<article class="box box-author" id="box-author-101318" style="display:none">
<header class="box-header">
<h1><i class="icon icon-quote-right"></i><span class="box-title-text">Auteurs</span></h1>
</header>
<div class="box-body">
<h2>Propriétaire du blog</h2>
<a href="about.html">
<figure class="inline-picture author-main">
<span class="picture">
<img src="https://size.blogspirit.net/hautetfort.com/lefetard/50/media/01/01/3775567719.png" alt=""/>
</span>
<figcaption class="description">
<p>joguess - 767 notes</p>
</figcaption>
</figure>
</a>
<ul role="list" class="authors-list">
</ul>
</div>
</article>
<!-- widget authors off --><!-- widget category on -->
<article class="box box-category" id="box-category-101322">
<header class="box-header">
<h1><i class="icon icon-level-down"></i><span class="box-title-text">Catégories</span></h1>
</header>
<div class="box-body">
<ul role="list" class="categories-list">

<li role="listitem">
<a href="index.html.21">Professionnel</a>
<ul>
<li role="listitem">
<a href="index.html.22">BIG DATA - hadoop -spark</a>
</li>
<li role="listitem">
<a href="index.html.23">Cassandra</a>
</li>
<li role="listitem">
<a href="index.html.24">Cloud Control 13C</a>
</li>
<li role="listitem">
<a href="index.html.25">Cloud db</a>
</li>
<li role="listitem">
<a href="index.html.26">HVAULT</a>
</li>
<li role="listitem">
<a href="index.html.27">MongoDB</a>
</li>
<li role="listitem">
<a href="index.html.28">monitoring</a>
</li>
<li role="listitem">
<a href="index.html.29">Ora2pg</a>
</li>
<li role="listitem">
<a href="index.html.30">Oracle RAC</a>
</li>
<li role="listitem">
<a href="index.html.31">Oracle12C,19C</a>
</li>
<li role="listitem">
<a href="index.html.32">Postgresql</a>
</li>
<li role="listitem">
<a href="index.html.33">RMAN</a>
</li>
<li role="listitem">
<a href="index.html.34">Scripts</a>
</li>
<li role="listitem">
<a href="index.html.35">Soluce</a>
</li>
<li role="listitem">
<a href="index.html.36">SQLServer</a>
</li>
<li role="listitem">
<a href="index.html.37">Système</a>
</li>
<li role="listitem">
<a href="index.html.38">tuning</a>
</li>
</ul>
</li>

</ul>
</div>
</article>
<!-- widget category off --><!-- widget links on -->
<article class="box box-link" id="box-custom-236539">
<header class="box-header">
<h1><i class="icon icon-link"></i><span class="box-title-text">Référencement</span></h1>
</header>
<div class="box-body">
<ul role="list" class="links-list">
<li role="listitem"><a href="http://www.extremecarving.com/index_fr.html" target="_blank">SURF</a></li>
<li role="listitem"><a href="http://secretebase.free.fr/" target="_blank">Base Secrète</a></li>
<li role="listitem"><a href="http://newzealand.over-blog.com/" target="_blank">Le blog de Mat</a></li>
<li role="listitem"><a href="http://missdactari-blog.blogspot.com/" target="_blank">Le Blog de Camille</a></li>
<li role="listitem"><a href="http://www.bobbydurrettdba.com/" target="_blank">Le Blog de Bobby DBA</a></li>
<li role="listitem"><a href="https://oraclue.com/" target="_blank">Miladin Modrakovic's Blog</a></li>
<li role="listitem"><a href="http://oradbastuff.blogspot.fr/" target="_blank">Sfaturi Oracle / Tips and tricks OracleDBA</a></li>
<li role="listitem"><a href="http://orababy.blogspot.fr/" target="_blank">ORACLE DBA Knowledge Share</a></li>
<li role="listitem"><a href="http://www.drazzib.com/docs/bdd/oracle/" target="_blank">Site de Damien Raude Morvan</a></li>
<li role="listitem"><a href="http://www.database-expert.com/" target="_blank">Edward Stoever DBA</a></li>
<li role="listitem"><a href="https://www.dba-scripts.com" target="_blank">Oracle DBA (Cyrille Modiano)</a></li>
</ul>
</div>
</article>
<!-- widget links off --><!-- widget archives on -->
<article class="box box-archive" id="box-archive-101316">
<header class="box-header">
<h1><i class="icon icon-archive"></i><span class="box-title-text">Archives</span></h1>
</header>
<div class="box-body">
<ul role="list" class="archives-list">
<li role="listitem">
<a href="index.html.46">lun. 29 juil. - dim. 04 août</a>
</li>
<li role="listitem">
<a href="index.html.47">lun. 08 juil. - dim. 14 juil.</a>
</li>
<li role="listitem">
<a href="index.html.48">lun. 17 juin - dim. 23 juin</a>
</li>
<li role="listitem">
<a href="index.html.49">lun. 10 juin - dim. 16 juin</a>
</li>
<li role="listitem">
<a href="index.html.50">lun. 27 mai - dim. 02 juin</a>
</li>
<li role="listitem">
<a href="index.html.51">lun. 20 mai - dim. 26 mai</a>
</li>
<li role="listitem">
<a href="index.html.52">lun. 13 mai - dim. 19 mai</a>
</li>
<li role="listitem">
<a href="index.html.53">lun. 29 avril - dim. 05 mai</a>
</li>
<li role="listitem">
<a href="index.html.54">lun. 22 avril - dim. 28 avril</a>
</li>
<li role="listitem">
<a href="index.html.55">lun. 15 avril - dim. 21 avril</a>
</li>
</ul>
</div>
<footer class="box-footer">
<p><a href="index.html.56">Toutes les archives</a></p>
</footer>
</article>
<!-- widget archives off --><!-- widget lastupdatedblogs on -->
<article class="box box-blog" id="box-blog-101319">
<header class="box-header">
<h1><i class="icon icon-external-link-sign"></i><span class="box-title-text">Derniers blogs mis à jour</span></h1>
</header>
<div class="box-body">
<ul role="list" class="last-posts-list">
<li role="listitem"><a href="http://linformationnationaliste.hautetfort.com/archive/2024/07/30/ouverture-des-jo-ces-sportifs-qui-n-ont-pas-aime-la-cene-6508849.html">Ouverture des JO : ces sportifs qui n’ont pas...</a> sur <a href="http://linformationnationaliste.hautetfort.com/">l'information nationaliste</a></li>
<li role="listitem"><a href="http://lactualitedessocialistes.hautetfort.com/archive/2024/07/31/le-recap-de-splann-un-rattrapage-de-l-actualite-bretonne-en-6508736.html">Le récap' de « Splann ! », un rattrapage de...</a> sur <a href="http://lactualitedessocialistes.hautetfort.com/">Actualités socialistes</a></li>
<li role="listitem"><a href="http://metapoinfos.hautetfort.com/archive/2024/07/20/j-d-vance-colistier-de-trump-et-figure-de-proue-des-nationau-6507781.html">J. D. Vance, colistier de Trump et figure de...</a> sur <a href="http://metapoinfos.hautetfort.com/">Métapo infos</a></li>
<li role="listitem"><a href="http://royaumedumaroc-hautetfort-nouvelle-ere.hautetfort.com/archive/2024/07/26/la-france-annoncent-la-reconnaissance-de-la-marocanite-du-sa-6508408.html">La France annonce la reconnaissance de la...</a> sur <a href="http://royaumedumaroc-hautetfort-nouvelle-ere.hautetfort.com/">«-Le Royaume Chérifien du Maroc -Chihab 25...</a></li>
<li role="listitem"><a href="http://formesetcouleurs.hautetfort.com/archive/2024/07/30/stage-adultes-2024-6508829.html">STAGE ADULTES JUILLET 2024</a> sur <a href="http://formesetcouleurs.hautetfort.com/">Formes & Couleurs</a></li>
<li role="listitem"><a href="http://cfdt-centrale-auchan.hautetfort.com/archive/2024/07/30/avis-cfdt-ari-sur-le-projet-d-organisation-de-la-direction-digitale.html">Avis CFDT ARI sur le projet d'organisation de...</a> sur <a href="http://cfdt-centrale-auchan.hautetfort.com/">CFDT Auchan Centrale ARS, ARA, ARI et OIA</a></li>
<li role="listitem"><a href="http://synthesenationale.hautetfort.com/archive/2024/07/30/lyon-suite-a-une-agression-gauchiste-un-jeune-nationaliste-temoigne.html">Lyon : suite à une agression gauchiste, un...</a> sur <a href="http://synthesenationale.hautetfort.com/">SYNTHESE NATIONALE</a></li>
<li role="listitem"><a href="http://www.belgicatho.be/archive/2024/07/30/tres-etrange-la-facon-dont-la-presse-mainstream-a-rendu-comp-6508818.html">Très étrange : la façon dont la presse...</a> sur <a href="http://www.belgicatho.be/">BELGICATHO</a></li>
<li role="listitem"><a href="http://www.cuisine-toulousaine.com/archive/2024/07/30/salade-de-saucisse-de-toulouse-et-lentilles-6508814.html">Salade de Saucisse de Toulouse et lentilles</a> sur <a href="http://www.cuisine-toulousaine.com/">Cuisine Toulousaine et Occitane</a></li>
<li role="listitem"><a href="http://lionelbaland.hautetfort.com/archive/2024/07/30/lionel-baland-dans-le-reportage-de-tv-libertes-sur-le-passag-6508813.html">Lionel Baland dans le reportage de TV Libertés...</a> sur <a href="http://lionelbaland.hautetfort.com/">Lionel Baland</a></li>
</ul>
</div>
</article>
<!-- widget lastupdatedblogs off --><!-- widget calendar on -->
<article class="box box-calendar" id="box-calendar-101321">
<header class="box-header">
<h1><i class="icon icon-calendar"></i><span class="box-title-text">Juillet 2024</span></h1>
</header>
<div class="box-body">
<table>
<caption>Calendrier des notes en Juillet 2024</caption>
<tr>
<th><abbr title="Dimanche">D</abbr></th>
<th><abbr title="Lundi">L</abbr></th>
<th><abbr title="Mardi">M</abbr></th>
<th><abbr title="Mercredi">M</abbr></th>
<th><abbr title="Jeudi">J</abbr></th>
<th><abbr title="Vendredi">V</abbr></th>
<th><abbr title="Samedi">S</abbr></th>
</tr>
<tr>
<td></td>
<td><span> 1</span></td>
<td><span> 2</span></td>
<td><span> 3</span></td>
<td><span> 4</span></td>
<td><span> 5</span></td>
<td><span> 6</span></td>
</tr>
<tr>
<td><span> 7</span></td>
<td><span> 8</span></td>
<td><span> 9</span></td>
<td class="has-post"><a href="index.html.57">10</a></td>
<td class="has-post"><a href="index.html.58">11</a></td>
<td class="has-post"><a href="index.html.59">12</a></td>
<td><span>13</span></td>
</tr>
<tr>
<td><span>14</span></td>
<td><span>15</span></td>
<td><span>16</span></td>
<td><span>17</span></td>
<td><span>18</span></td>
<td><span>19</span></td>
<td><span>20</span></td>
</tr>
<tr>
<td><span>21</span></td>
<td><span>22</span></td>
<td><span>23</span></td>
<td><span>24</span></td>
<td><span>25</span></td>
<td><span>26</span></td>
<td><span>27</span></td>
</tr>
<tr>
<td><span>28</span></td>
<td><span>29</span></td>
<td class="has-post today"><a href="index.html.60">30</a></td>
<td><span>31</span></td>
<td></td>
<td></td>
<td></td>
</tr>
</table>
</div>
</article>
<!-- widget calendar off --><!-- widget comments on -->
<article class="box box-comment" id="box-comment-101324">
<header class="box-header">
<h1><i class="icon icon-comments"></i><span class="box-title-text">Commentaires récents</span></h1>
</header>
<div class="box-body">
<ul role="list" class="list-dated recent-comments-list">
<li role="listitem">
<article class="recent-comment" role="article" id="recent-comment9030164" itemscope="itemscope" itemtype="http://schema.org/BlogPosting" data-url="http://lefetard.hautetfort.com/archive/2022/12/22/intermediation-6418406.html#c9030164">
<header class="recent-comment-header">
<span class="date recent-comment-date">
<time pubdate="pubdate" datetime="2022-12-22T18:29:12" itemprop="datePublished">
<span class="date-hour-minute">18h29</span>
<span class="date-day">22</span>
<span class="date-month-year">déc. 2022</span>
</time>
</span>
<h1 class="recent-comment-title"><a href="http://lefetard.hautetfort.com/archive/2022/12/22/intermediation-6418406.html#c9030164">collignon</a> sur <a href="http://lefetard.hautetfort.com/archive/2022/12/22/intermediation-6418406.html">Intermédiation</a></h1>
</header>
<div class="recent-comment-body">
<p>"Confidentielles" au féminin pluriel, merci.<p>
</div>
</article>
</li>
<li role="listitem">
<article class="recent-comment" role="article" id="recent-comment8994604" itemscope="itemscope" itemtype="http://schema.org/BlogPosting" data-url="http://lefetard.hautetfort.com/archive/2022/01/27/tuning-ora2pg-6362720.html#c8994604">
<header class="recent-comment-header">
<span class="date recent-comment-date">
<time pubdate="pubdate" datetime="2022-01-27T09:27:05" itemprop="datePublished">
<span class="date-hour-minute">09h27</span>
<span class="date-day">27</span>
<span class="date-month-year">janv. 2022</span>
</time>
</span>
<h1 class="recent-comment-title"><a href="tuning-ora2pg-6362720.html#c8994604">Le boss</a> sur <a href="tuning-ora2pg-6362720.html">Tuning ora2pg</a></h1>
</header>
<div class="recent-comment-body">
<p>1- bah ouais poto si tu vides les data source ça va plus...<p>
</div>
</article>
</li>
<li role="listitem">
<article class="recent-comment" role="article" id="recent-comment8626826" itemscope="itemscope" itemtype="http://schema.org/BlogPosting" data-url="http://lefetard.hautetfort.com/archive/2017/06/29/forcer-le-refresh-de-la-vue-dba-feature-usage-statistics-5958652.html#c8626826">
<header class="recent-comment-header">
<span class="date recent-comment-date">
<time pubdate="pubdate" datetime="2017-06-29T17:31:31" itemprop="datePublished">
<span class="date-hour-minute">17h31</span>
<span class="date-day">29</span>
<span class="date-month-year">juin 2017</span>
</time>
</span>
<h1 class="recent-comment-title"><a href="forcer-le-refresh-de-la-vue-dba-feature-usage-statistics-5958652.html#c8626826">joguess</a> sur <a href="forcer-le-refresh-de-la-vue-dba-feature-usage-statistics-5958652.html">Forcer le refresh de la vue...</a></h1>
</header>
<div class="recent-comment-body">
<p>peut etre rajouter cela : 
BEGIN...<p>
</div>
</article>
</li>
<li role="listitem">
<article class="recent-comment" role="article" id="recent-comment8579037" itemscope="itemscope" itemtype="http://schema.org/BlogPosting" data-url="http://lefetard.hautetfort.com/archive/2017/01/31/purger-fichiers-logs-5905505.html#c8579037">
<header class="recent-comment-header">
<span class="date recent-comment-date">
<time pubdate="pubdate" datetime="2017-01-31T14:59:55" itemprop="datePublished">
<span class="date-hour-minute">14h59</span>
<span class="date-day">31</span>
<span class="date-month-year">janv. 2017</span>
</time>
</span>
<h1 class="recent-comment-title"><a href="purger-fichiers-logs-5905505.html#c8579037">joguess</a> sur <a href="purger-fichiers-logs-5905505.html">Purger fichiers logs</a></h1>
</header>
<div class="recent-comment-body">
<p>voir aussi :...<p>
</div>
</article>
</li>
<li role="listitem">
<article class="recent-comment" role="article" id="recent-comment8518755" itemscope="itemscope" itemtype="http://schema.org/BlogPosting" data-url="http://lefetard.hautetfort.com/archive/2016/08/11/oracleasm-createdisk-failed-5835514.html#c8518755">
<header class="recent-comment-header">
<span class="date recent-comment-date">
<time pubdate="pubdate" datetime="2016-08-11T16:14:31" itemprop="datePublished">
<span class="date-hour-minute">16h14</span>
<span class="date-day">11</span>
<span class="date-month-year">août 2016</span>
</time>
</span>
<h1 class="recent-comment-title"><a href="oracleasm-createdisk-failed-5835514.html#c8518755">JJO</a> sur <a href="oracleasm-createdisk-failed-5835514.html">oracleasm createdisk failed</a></h1>
</header>
<div class="recent-comment-body">
<p>La solution se trouve ici :...<p>
</div>
</article>
</li>
<li role="listitem">
<article class="recent-comment" role="article" id="recent-comment8518754" itemscope="itemscope" itemtype="http://schema.org/BlogPosting" data-url="http://lefetard.hautetfort.com/archive/2016/08/11/oracleasm-createdisk-failed-5835514.html#c8518754">
<header class="recent-comment-header">
<span class="date recent-comment-date">
<time pubdate="pubdate" datetime="2016-08-11T16:12:03" itemprop="datePublished">
<span class="date-hour-minute">16h12</span>
<span class="date-day">11</span>
<span class="date-month-year">août 2016</span>
</time>
</span>
<h1 class="recent-comment-title"><a href="oracleasm-createdisk-failed-5835514.html#c8518754">JJO</a> sur <a href="oracleasm-createdisk-failed-5835514.html">oracleasm createdisk failed</a></h1>
</header>
<div class="recent-comment-body">
<p>http://www.dba-oracle.com/t_asm_disk_does_not_exist_or_is...<p>
</div>
</article>
</li>
<li role="listitem">
<article class="recent-comment" role="article" id="recent-comment8518753" itemscope="itemscope" itemtype="http://schema.org/BlogPosting" data-url="http://lefetard.hautetfort.com/archive/2016/08/10/installation-asm-et-configuration-de-l-instance-asm-5835041.html#c8518753">
<header class="recent-comment-header">
<span class="date recent-comment-date">
<time pubdate="pubdate" datetime="2016-08-11T15:59:29" itemprop="datePublished">
<span class="date-hour-minute">15h59</span>
<span class="date-day">11</span>
<span class="date-month-year">août 2016</span>
</time>
</span>
<h1 class="recent-comment-title"><a href="installation-asm-et-configuration-de-l-instance-asm-5835041.html#c8518753">JJO</a> sur <a href="installation-asm-et-configuration-de-l-instance-asm-5835041.html">Installation ASM et configuration de l'instance...</a></h1>
</header>
<div class="recent-comment-body">
<p>https://taliphakanozturken.wordpress.com/2012/03/12/confi...<p>
</div>
</article>
</li>
<li role="listitem">
<article class="recent-comment" role="article" id="recent-comment8518135" itemscope="itemscope" itemtype="http://schema.org/BlogPosting" data-url="http://lefetard.hautetfort.com/archive/2016/08/07/outil-de-benchmark-oracle-orion-5834320.html#c8518135">
<header class="recent-comment-header">
<span class="date recent-comment-date">
<time pubdate="pubdate" datetime="2016-08-09T08:19:40" itemprop="datePublished">
<span class="date-hour-minute">08h19</span>
<span class="date-day">09</span>
<span class="date-month-year">août 2016</span>
</time>
</span>
<h1 class="recent-comment-title"><a href="outil-de-benchmark-oracle-orion-5834320.html#c8518135">jjo</a> sur <a href="outil-de-benchmark-oracle-orion-5834320.html">Outil de benchmark Oracle - ORION</a></h1>
</header>
<div class="recent-comment-body">
<p>Orion Usage:$ORACLE_HOME/bin/orion -run simple -testname...<p>
</div>
</article>
</li>
<li role="listitem">
<article class="recent-comment" role="article" id="recent-comment8314452" itemscope="itemscope" itemtype="http://schema.org/BlogPosting" data-url="http://lefetard.hautetfort.com/archive/2015/04/19/sego-dans-c-politique-5606540.html#c8314452">

<!-- widget comments off -->
<!-- widget pages on -->
<article class="box box-page" id="box-page-101331">
<header class="box-header">
<h1><i class="icon icon-file-text-alt"></i><span class="box-title-text">Pages</span></h1>
</header>
<div class="box-body">
<ul role="list" class="pages-list">
<li role="listitem">
<a href="jesako.html">PAGE HTML</a>
</li>
</ul>
</div>
</article>
<!-- widget pages off --><!-- widget posts on -->
<article class="box box-post" id="box-post-101336">
<header class="box-header">
<h1><i class="icon icon-comment"></i><span class="box-title-text">Notes récentes</span></h1>
</header>
<div class="box-body">
<ul role="list" class="list-dated recent-posts-list">
<li role="listitem">
<article class="recent-post" role="article" id="recent-post6508824" itemscope="itemscope" itemtype="http://schema.org/BlogPosting" data-url="http://lefetard.hautetfort.com/archive/2024/07/30/postgres-monitor-autovacuum-freeze-max-age-6508824.html">
<header class="recent-post-header">
<span class="date recent-post-date">
<time pubdate="pubdate" datetime="2024-07-30T10:40:49" itemprop="datePublished">
<span class="date-hour-minute">10h40</span>
<span class="date-day">30</span>
<span class="date-month-year">juil. 2024</span>
</time>
</span>
<h1 class="recent-post-title"><a href="postgres-monitor-autovacuum-freeze-max-age-6508824.html">[Postgres] Monitor autovacuum_freeze_max_age</a></h1>
</header>
<div class="recent-post-body">
<p> This query allows you to monitor the :...<p>
</div>
</article>
</li>
<li role="listitem">
<article class="recent-post" role="article" id="recent-post6506680" itemscope="itemscope" itemtype="http://schema.org/BlogPosting" data-url="http://lefetard.hautetfort.com/archive/2024/07/12/postgres-monitor-wait-event-6506680.html">
<header class="recent-post-header">
<span class="date recent-post-date">
<time pubdate="pubdate" datetime="2024-07-12T11:28:00" itemprop="datePublished">
<span class="date-hour-minute">11h28</span>
<span class="date-day">12</span>
<span class="date-month-year">juil. 2024</span>
</time>
</span>
<h1 class="recent-post-title"><a href="postgres-monitor-wait-event-6506680.html">[Postgres] Monitor wait event</a></h1>
</header>
<div class="recent-post-body">
<p> \t select wait_event_type, wait_event from...<p>
</div>
</article>
</li>
<li role="listitem">
<article class="recent-post" role="article" id="recent-post6506515" itemscope="itemscope" itemtype="http://schema.org/BlogPosting" data-url="http://lefetard.hautetfort.com/archive/2024/07/11/postgres-solve-postgresql-datafileread-and-buffer-io-with-p-6506515.html">
<header class="recent-post-header">
<span class="date recent-post-date">
<time pubdate="pubdate" datetime="2024-07-11T10:02:00" itemprop="datePublished">
<span class="date-hour-minute">10h02</span>
<span class="date-day">11</span>
<span class="date-month-year">juil. 2024</span>
</time>
</span>
<h1 class="recent-post-title"><a href="postgres-solve-postgresql-datafileread-and-buffer-io-with-p-6506515.html">[Postgres] Solve PostgreSQL DataFileRead and...</a></h1>
</header>
<div class="recent-post-body">
<p> Click her to see the next. <p>
</div>
</article>
</li>
<li role="listitem">
<article class="recent-post" role="article" id="recent-post6506355" itemscope="itemscope" itemtype="http://schema.org/BlogPosting" data-url="http://lefetard.hautetfort.com/archive/2024/07/10/postgres-tuto-tuning-6506355.html">
<header class="recent-post-header">
<span class="date recent-post-date">
<time pubdate="pubdate" datetime="2024-07-10T07:59:04" itemprop="datePublished">
<span class="date-hour-minute">07h59</span>
<span class="date-day">10</span>
<span class="date-month-year">juil. 2024</span>
</time>
</span>
<h1 class="recent-post-title"><a href="postgres-tuto-tuning-6506355.html">[Postgres] Tuto tuning</a></h1>
</header>
<div class="recent-post-body">
<p> This site helped to resolve IPC wait event :  Postgres...<p>
</div>
</article>
</li>
<li role="listitem">
<article class="recent-post" role="article" id="recent-post6503410" itemscope="itemscope" itemtype="http://schema.org/BlogPosting" data-url="http://lefetard.hautetfort.com/archive/2024/06/18/postgres-identifier-les-privileges-6503410.html">
<header class="recent-post-header">
<span class="date recent-post-date">
<time pubdate="pubdate" datetime="2024-06-18T10:03:31" itemprop="datePublished">
<span class="date-hour-minute">10h03</span>
<span class="date-day">18</span>
<span class="date-month-year">juin 2024</span>
</time>
</span>
<h1 class="recent-post-title"><a href="postgres-identifier-les-privileges-6503410.html">[Postgres] Identifier les privilèges</a></h1>
</header>
<div class="recent-post-body">
<p> SELECT * &nbsp; FROM...<p>
</div>
</article>
</li>
<li role="listitem">
<article class="recent-post" role="article" id="recent-post6502501" itemscope="itemscope" itemtype="http://schema.org/BlogPosting" data-url="http://lefetard.hautetfort.com/archive/2024/06/11/postgres-identifier-les-attentes-6502501.html">
<header class="recent-post-header">
<span class="date recent-post-date">
<time pubdate="pubdate" datetime="2024-06-11T14:21:00" itemprop="datePublished">
<span class="date-hour-minute">14h21</span>
<span class="date-day">11</span>
<span class="date-month-year">juin 2024</span>
</time>
</span>
<h1 class="recent-post-title"><a href="postgres-identifier-les-attentes-6502501.html">[Postgres] Identifier les attentes</a></h1>
</header>
<div class="recent-post-body">
<p> This query allows you to identify the wait events on...<p>
</div>
</article>
</li>
<li role="listitem">
<article class="recent-post" role="article" id="recent-post6500731" itemscope="itemscope" itemtype="http://schema.org/BlogPosting" data-url="http://lefetard.hautetfort.com/archive/2024/05/30/postgres-pg-partman-6500731.html">
<header class="recent-post-header">
<span class="date recent-post-date">
<time pubdate="pubdate" datetime="2024-05-30T10:56:00" itemprop="datePublished">
<span class="date-hour-minute">10h56</span>
<span class="date-day">30</span>
<span class="date-month-year">mai 2024</span>
</time>
</span>
<h1 class="recent-post-title"><a href="postgres-pg-partman-6500731.html">[Postgres] PG_PARTMAN</a></h1>
</header>
<div class="recent-post-body">
<p> pg_partman v4 vs pg_partman v5&nbsp; 
 Une fonction...<p>
</div>
</article>
</li>
<li role="listitem">
<article class="recent-post" role="article" id="recent-post6500641" itemscope="itemscope" itemtype="http://schema.org/BlogPosting" data-url="http://lefetard.hautetfort.com/archive/2024/05/29/postgres-extensions-6500641.html">
<header class="recent-post-header">
<span class="date recent-post-date">
<time pubdate="pubdate" datetime="2024-05-29T17:27:00" itemprop="datePublished">
<span class="date-hour-minute">17h27</span>
<span class="date-day">29</span>
<span class="date-month-year">mai 2024</span>
</time>
</span>
<h1 class="recent-post-title"><a href="postgres-extensions-6500641.html">[Postgres] Extensions</a></h1>
</header>
<div class="recent-post-body">
<p> Extensions en prd indispensables :&nbsp; <p>
</div>
</article>
</li>
<li role="listitem">
<article class="recent-post" role="article" id="recent-post6500591" itemscope="itemscope" itemtype="http://schema.org/BlogPosting" data-url="http://lefetard.hautetfort.com/archive/2024/05/29/postgres-monitor-cloud-db-azure-ibm-6500591.html">
<header class="recent-post-header">
<span class="date recent-post-date">
<time pubdate="pubdate" datetime="2024-05-29T10:59:00" itemprop="datePublished">
<span class="date-hour-minute">10h59</span>
<span class="date-day">29</span>
<span class="date-month-year">mai 2024</span>
</time>
</span>
<h1 class="recent-post-title"><a href="postgres-monitor-cloud-db-azure-ibm-6500591.html">[Postgres] Monitor cloud DB (AZURE / IBM)</a></h1>
</header>
<div class="recent-post-body">
<p> Quand on n'a pas d'outils pour faire le monitoring des...<p>
</div>
</article>
</li>
<li role="listitem">
<article class="recent-post" role="article" id="recent-post6499803" itemscope="itemscope" itemtype="http://schema.org/BlogPosting" data-url="http://lefetard.hautetfort.com/archive/2024/05/24/postgres-locker-une-base-6499803.html">
<header class="recent-post-header">
<span class="date recent-post-date">
<time pubdate="pubdate" datetime="2024-05-24T10:01:00" itemprop="datePublished">
<span class="date-hour-minute">10h01</span>
<span class="date-day">24</span>
<span class="date-month-year">mai 2024</span>
</time>
</span>
<h1 class="recent-post-title"><a href="postgres-locker-une-base-6499803.html">[Postgres] Locker une base</a></h1>
</header>
<div class="recent-post-body">
<p> On ne peut pas locker une base nativement alors comment...<p>
</div>
</article>
</li>
</ul>
</div>
</article>
<!-- widget posts off --><!-- widget sharing on -->
<article class="box box-sharing" id="box-sharing-101338">
<div class="box-body">
<ul role="list" class="sharing-list">
<li role="listitem"><a href="index.php" title="Email"><span class="icon-container"><i class="icon icon-envelope"></i><span class="mask-text">Email</span></span></a></li>
</ul>
</div>
</article>
<!-- widget sharing off --><!-- widget populartags on -->
<article class="box box-tag" id="box-tag-101340">
<header class="box-header">
<h1><i class="icon icon-tags"></i><span class="box-title-text">Tags populaires</span></h1>
</header>
<div class="box-body">
<ul class="popular-tags-list" role="list">
<li role="listitem"><a href="http://lefetard.hautetfort.com/tag/dieudonn%C3%A9" class="tag-10">dieudonné</a></li>
<li role="listitem"><a href="http://lefetard.hautetfort.com/tag/strasbourg" class="tag-10">strasbourg</a></li>
<li role="listitem"><a href="http://lefetard.hautetfort.com/tag/star" class="tag-10">star</a></li>
<li role="listitem"><a href="http://lefetard.hautetfort.com/tag/surf" class="tag-9">surf</a></li>
<li role="listitem"><a href="http://lefetard.hautetfort.com/tag/salsa" class="tag-1">salsa</a></li>
<li role="listitem"><a href="http://lefetard.hautetfort.com/tag/sexy" class="tag-10">sexy</a></li>
<li role="listitem"><a href="http://lefetard.hautetfort.com/tag/danse" class="tag-9">danse</a></li>
<li role="listitem"><a href="http://lefetard.hautetfort.com/tag/webcam" class="tag-9">webcam</a></li>
<li role="listitem"><a href="http://lefetard.hautetfort.com/tag/blog" class="tag-10">blog</a></li>
<li role="listitem"><a href="http://lefetard.hautetfort.com/tag/oracle" class="tag-8">oracle</a></li>
</ul>
</div>
</article>
<!-- widget populartags off --><!-- end column 1 --></aside>
</div>
<div class="span8">
<main role="main">
<section class="content-intro">
<nav role="navigation" itemprop="breadcrumb">
<ul role="menu" class="article-nav">
<li role="menuitem" class="breadcrumb-previous"><a href="modifier-l-encodage-postgresql-en-utf8-6339378.html">Modifier l'encodage PostgreSQL en UTF8</a></li><li role="menuitem" class="breadcrumb-root"><a href="index-0.html">Page d'accueil</a></li>
<li role="menuitem" class="breadcrumb-next"><a href="postgresql-compress-6375737.html">[PostgreSQL] COMPRESS</a></li></ul>
</nav>
</section>

<section class="content" id="content" itemprop="mainContentOfPage">
<div class="content-body">
<!-- widget article on -->
<article class="box box-article" role="article" id="article6415415" itemscope="itemscope" itemtype="http://schema.org/BlogPosting" data-url="http://lefetard.hautetfort.com/archive/2022/12/05/deploy-new-postgresql-instance-dmzr-6415415.html">
<header class="box-header">
<div class="pre-article-title">
<div><!-- start post 1 --><!-- end post 1 --></div>
</div>
<span class="date box-article-date">
<time pubdate="pubdate" datetime="2023-09-30T20:32:25" itemprop="datePublished">
<span class="date-hour-minute">20h32</span>
<span class="date-day">30</span>
<span class="date-month-year">sept. 2023</span>
</time>
</span>
<h1 itemprop="name headline"><a href="deploy-new-postgresql-instance-dmzr-6415415.html">Deploy new postgreSQL instance dMZR</a></h1>
<div class="post-article-title">
<div><!-- start post 2 --><span class="box-article-link box-article-facebook-like">
<iframe src="https://www.facebook.com/plugins/like.php?href=http%3A%2F%2Flefetard.hautetfort.com%2Farchive%2F2022%2F12%2F05%2Fdeploy-new-postgresql-instance-dmzr-6415415.html&amp;layout=button_count&amp;show_faces=false&amp;width=100&amp;action=like&amp;colorscheme=light" scrolling="no" frameborder="0" allowTransparency="true" style="width:100px;height:22px"></iframe>
</span><!-- end post 2 --></div>
</div>
</header>
<section class="clearfix box-body" itemprop="articleBody">
<p>Deploy new postgreSQL instance dMZR</p>
<a id="more"></a>
<pre><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">#!/bin/sh</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">#set -ex</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">cd $ORA2PG_HOME/hvault</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">while true</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">do</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">if [ "$#" -eq &nbsp;"0" ]</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; then</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">clear</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">echo " "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">echo " Welcome to the program of a new deployment in &lt;cloudDBname&gt; - dMZR"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">echo " "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">echo " "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">echo " 1 - Create a new role"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">echo " 2 - Deploy the script of connection"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">echo " q - Quit."</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">echo " "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">read var</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp;case $var in</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; 1)</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; clear</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo " "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; if [[ "$VAULT_ADDR" == &lt;url_prod&gt; ]]</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; then</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; ENV="prod"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; cat $ORA2PG_HOME/adm/sh/prod</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo " "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo "Give the name of the ecosystem :"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; read ECOSYSTEM</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; SERVER=$(cat $ORA2PG_HOME/adm/sh/prod | grep -i $ECOSYSTEM | &nbsp;awk &nbsp;'{print $4}')</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo "Give the name of the instance :"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo "$SERVER"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo " "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; read SERVER</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo " "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; ASSET=$(cat $ORA2PG_HOME/adm/sh/prod | grep -i $SERVER | &nbsp;awk &nbsp;'{print $1}')</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; APREFI=$(cat $ORA2PG_HOME/adm/sh/prod | grep -i $SERVER | &nbsp;awk &nbsp;'{print $6}')</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo " "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo " Give the type of account to create (dba|own|app) :"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; read TYPE</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo " "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo " The database is : $ASSET"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo " "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; ENVDIR="$ORA2PG_HOME/$ENV/$ASSET"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; else</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if [[ "$VAULT_ADDR" == &lt;url_hors_prod&gt; ]]</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;then</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ENV="nonprod"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;cat &nbsp;$ORA2PG_HOME/adm/sh/nonprod</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;echo " "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;echo "Give the name of the ecosystem :"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;read ECOSYSTEM</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;SERVER=$(cat $ORA2PG_HOME/adm/sh/nonprod | grep -i $ECOSYSTEM | &nbsp;awk &nbsp;'{print $4}')</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;echo "Give the name of the instance :"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;echo "$SERVER"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;echo " "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;read SERVER</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ASSET=$(cat $ORA2PG_HOME/adm/sh/nonprod | grep -i $SERVER | &nbsp;awk &nbsp;'{print $1}')</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;APREFI=$(cat $ORA2PG_HOME/adm/sh/nonprod | grep -i $SERVER | &nbsp;awk &nbsp;'{print $6}')</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;SOUSENV=$(cat $ORA2PG_HOME/adm/sh/nonprod | grep -i $SERVER | &nbsp;awk &nbsp;'{print $2}')</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;echo " "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;echo " Give the type of account to create (own|app|dba) :"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;read TYPE</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;echo " "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;echo " The environment of non prod is : $SOUSENV"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;echo " The database is : $ASSET"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;echo " "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ENVDIR="$ORA2PG_HOME/$ENV/$SOUSENV/$ASSET"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;else</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;echo " Wrong environment "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;exit 1</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;fi</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; fi</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">mkdir -p $ENVDIR</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">if [[ "$TYPE" == dba ]]</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">then</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">STATIC_ROLE_NAME="dba_pg"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">echo " You are going to create the role : "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">echo " $STATIC_ROLE_NAME."</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">cat &lt;&lt;EOF&gt; /tmp/dynamic-creation-statements.sql</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">DO</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">$do$</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">BEGIN</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">IF NOT EXISTS (</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">SELECT</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">FROM pg_roles</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">WHERE rolname = '$STATIC_ROLE_NAME') THEN</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">CREATE ROLE "$STATIC_ROLE_NAME" LOGIN CREATEDB CREATEROLE PASSWORD '{{password}}';</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">END IF;</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">create role "{{name}}" with login createdb createrole password '{{password}}' CONNECTION LIMIT 5 VALID UNTIL '{{expiration}}' in role pg_monitor,pg_signal_backend,"ibm-cloud-base-user" ;</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">grant "{{name}}" to admin ;</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">IF NOT EXISTS (</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">SELECT FROM pg_catalog.pg_extension WHERE extname = 'pg_buffercache') THEN CREATE EXTENSION "pg_buffercache";</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">END IF;</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">IF NOT EXISTS (</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">SELECT FROM pg_catalog.pg_extension WHERE extname = 'pg_stat_statements') THEN CREATE EXTENSION "pg_stat_statements";</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">END IF;</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">IF NOT EXISTS (</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">SELECT FROM pg_catalog.pg_extension WHERE extname = 'pg_freespacemap') THEN CREATE EXTENSION "pg_freespacemap";</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">END IF;</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">IF NOT EXISTS (</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">SELECT FROM pg_catalog.pg_extension WHERE extname = 'pg_repack') THEN CREATE EXTENSION "pg_repack";</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">END IF;</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">IF NOT EXISTS (</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">SELECT FROM pg_catalog.pg_extension WHERE extname = 'pgstattuple') THEN CREATE EXTENSION "pgstattuple";</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">END IF;</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">END</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">$do$;</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">EOF</span><br /><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">cat &lt;&lt;EOF&gt; /tmp/dynamic-revocation-statements.sql</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">REASSIGN OWNED BY "{{name}}" to "ibm-cloud-base-user";</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">DROP OWNED by "{{name}}" ;</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">DROP ROLE IF EXISTS "{{name}}" ;</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">EOF</span><br /><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">DYNAMIC_ROLE_NAME="tmp-$(head /dev/urandom | tr -dc a-z0-9 | head -c 13 ; echo '')"</span><br /><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">result=$(vault write -ns="$VAULT_NAMESPACE/$ECOSYSTEM" </span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; database/postgres/${SERVER}/roles/${DYNAMIC_ROLE_NAME} </span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; db_name=${SERVER} </span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; creation_statements=@/tmp/dynamic-creation-statements.sql </span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; revocation_statements=@/tmp/dynamic-revocation-statements.sql </span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; default_ttl=24h </span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; max_ttl=8d 2&gt;&amp;1)</span><br /><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">if [[ $(echo "$result" | grep 'Success!' | wc -l) -lt 1 &nbsp;]]; then</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; echo "Can't create temporary dynamic role ${DYNAMIC_ROLE_NAME}: $result"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; exit 1</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">fi</span><br /><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">result=$(vault read -ns="$VAULT_NAMESPACE/$ECOSYSTEM" </span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; database/postgres/${SERVER}/creds/${DYNAMIC_ROLE_NAME} 2&gt;&amp;1)</span><br /><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">if [[ $(echo "$result" | grep 'lease_id' | wc -l) -lt 1 &nbsp;]]; then</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; echo "Can't execute SQL query: $result"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; exit 2</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">fi</span><br /><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">echo "Role $DYNAMIC_ROLE_NAME succefully created in DB. You can now create a Vault static role named $STATIC_ROLE_NAME."</span><br /><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">result=$(vault delete -ns="$VAULT_NAMESPACE/$ECOSYSTEM" </span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; database/postgres/${SERVER}/roles/${DYNAMIC_ROLE_NAME} 2&gt;&amp;1)</span><br /><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">if [[ $(echo "$result" | grep 'Success!' | wc -l) -lt 1 &nbsp;]]; then</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; echo "Can't delete temporary role ${DYNAMIC_ROLE_NAME}: $result"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">fi</span><br /><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">cat &lt;&lt;EOF&gt; /tmp/static-rotation-statement.sql</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">ALTER ROLE "{{name}}" WITH PASSWORD '{{password}}';</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">EOF</span><br /><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; vault write -ns="$VAULT_NAMESPACE/$ECOSYSTEM" database/postgres/${SERVER}/static-roles/${STATIC_ROLE_NAME} </span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; db_name=${SERVER} </span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; creation_statements=@/tmp/dynamic-creation-statements.sql </span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; rotation_statements=@/tmp/static-rotation-statement.sql </span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; default_ttl=24h </span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; max_ttl=8d </span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; username=${STATIC_ROLE_NAME} </span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; rotation_period=12h</span><br /><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; #creation of a sysdba role inside the database</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; touch $ENVDIR/sysdba_${SERVER}_${ASSET}.sql</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; echo "CREATE ROLE sysdba WITH LOGIN CREATEDB CREATEROLE PASSWORD 'xxxxxxxxxxxxx';"&gt;$ENVDIR/sysdba_${SERVER}_${ASSET}.sql</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; echo "GRANT CREATE ON DATABASE &lt;cloudDBname&gt; TO sysdba;"&gt;&gt;$ENVDIR/sysdba_${SERVER}_${ASSET}.sql</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; echo "GRANT USAGE,CREATE ON SCHEMA own_${APREFI}_${ASSET} TO sysdba;"&gt;&gt;$ENVDIR/sysdba_${SERVER}_${ASSET}.sql</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; echo "GRANT SELECT,UPDATE,INSERT,DELETE ON ALL TABLES IN SCHEMA own_${APREFI}_${ASSET} TO sysdba;"&gt;&gt;$ENVDIR/sysdba_${SERVER}_${ASSET}.sql</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; echo "GRANT USAGE ON ALL SEQUENCES IN SCHEMA own_${APREFI}_${ASSET} TO sysdba;"&gt;&gt;$ENVDIR/sysdba_${SERVER}_${ASSET}.sql</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; echo "GRANT EXECUTE ON ALL FUNCTIONS in SCHEMA own_${APREFI}_${ASSET} TO sysdba;"&gt;&gt;$ENVDIR/sysdba_${SERVER}_${ASSET}.sql</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; echo "GRANT admin,"ibm-cloud-base-user",role_own_${APREFI}_${ASSET} TO sysdba;"&gt;&gt;$ENVDIR/sysdba_${SERVER}_${ASSET}.sql</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; echo "ALTER ROLE sysdba SET search_path TO own_${APREFI}_${ASSET};"&gt;&gt;$ENVDIR/sysdba_${SERVER}_${ASSET}.sql</span><br /><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; echo "Role $STATIC_ROLE_NAME succefully created in DB."</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; echo " "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; echo "Role sysdba can be created from $ENVDIR/sysdba_${SERVER}_${ASSET}.sql."</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; echo " "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; echo "Press enter to create a new role or ctrl C to quit"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; read bidon</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">else</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; echo " You are going to create the role : "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; echo " ${TYPE}_${APREFI}_${ASSET} "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; ROLE="${TYPE}_${APREFI}_${ASSET}"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; touch ${ORA2PG_HOME}/dynamic_role/${TYPE}/drop_dyna_role_${TYPE}_${ASSET}.sql</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; echo "revoke admin from "{{name}}" ;"&gt;${ORA2PG_HOME}/dynamic_role/${TYPE}/drop_dyna_role_${TYPE}_${ASSET}.sql</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; echo "grant "{{name}}" to admin ;"&gt;&gt;${ORA2PG_HOME}/dynamic_role/${TYPE}/drop_dyna_role_${TYPE}_${ASSET}.sql</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; echo "REASSIGN OWNED BY "{{name}}" to role_${TYPE}_${APREFI}_${ASSET};"&gt;&gt;${ORA2PG_HOME}/dynamic_role/${TYPE}/drop_dyna_role_${TYPE}_${ASSET}.sql</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; echo "DROP OWNED by "{{name}}" ;"&gt;&gt;${ORA2PG_HOME}/dynamic_role/${TYPE}/drop_dyna_role_${TYPE}_${ASSET}.sql</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; echo "DROP ROLE IF EXISTS "{{name}}";"&gt;&gt;${ORA2PG_HOME}/dynamic_role/${TYPE}/drop_dyna_role_${TYPE}_${ASSET}.sql</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; #copy of the template to create the dynamic role</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; cp ${ORA2PG_HOME}/dynamic_role/template/create_dyna_role_${TYPE}_apro.sql ${ORA2PG_HOME}/dynamic_role/${TYPE}/create_dyna_role_${TYPE}_${ASSET}.sql</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; while read ; do</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; sed -i.bak "s/&lt;nom_applicatif&gt;/${APREFI}_${ASSET}/g" ${ORA2PG_HOME}/dynamic_role/${TYPE}/create_dyna_role_${TYPE}_${ASSET}.sql</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; sed -i.bak "s/&lt;schema&gt;/own_${APREFI}_${ASSET}/g" ${ORA2PG_HOME}/dynamic_role/${TYPE}/create_dyna_role_${TYPE}_${ASSET}.sql</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp;done &lt; ${ORA2PG_HOME}/dynamic_role/${TYPE}/create_dyna_role_${TYPE}_${ASSET}.sql</span><br /><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp;#creation of the dynamic role in hashicorp vault</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp;vault write -ns="$VAULT_NAMESPACE/$ECOSYSTEM" database/postgres/${SERVER}/roles/${ROLE} </span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp;db_name=${SERVER} </span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp;creation_statements=@${ORA2PG_HOME}/dynamic_role/${TYPE}/create_dyna_role_${TYPE}_${ASSET}.sql </span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp;revocation_statements=@${ORA2PG_HOME}/dynamic_role/${TYPE}/drop_dyna_role_${TYPE}_${ASSET}.sql </span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp;default_ttl=24h </span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp;max_ttl=8d</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp;echo " "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp;echo "!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp;echo "!!! The role ${TYPE}_${APREFI}_${ASSET} is created !!! "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp;echo "!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp;echo " "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp;echo "Press enter to create a new role or ctrl C to quit"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp;read bidon</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp;fi</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp;;;</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp;2)</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; clear</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo " "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; if [[ "$VAULT_ADDR" == &lt;url_prod&gt; ]]</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; then</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; ENV="prod"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; cat &nbsp;$ORA2PG_HOME/adm/sh/prod</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo " "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo "Give the name of the ecosystem :"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; read ECOSYSTEM</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; SERVER=$(cat $ORA2PG_HOME/adm/sh/prod | grep -i $ECOSYSTEM | &nbsp;awk &nbsp;'{print $4}')</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo " "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo "Give the name of the instance:"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo "$SERVER"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo " "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; read SERVER</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo " "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; ASSET=$(cat $ORA2PG_HOME/adm/sh/prod | grep -i $SERVER | &nbsp;awk &nbsp;'{print $1}')</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo " "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo " The database is : $ASSET"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo " "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo " The Env is : $ENV"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo " "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo " The deployment is on progress..."</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; #creation of a new directory to store the connection script</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; ENVDIR="$ORA2PG_HOME/$ENV/$ASSET"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; mkdir -p $ENVDIR</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; cp ${ORA2PG_HOME}/adm/sh/template.sh ${ORA2PG_HOME}/${ENV}/${ASSET}/${ASSET}${ENV}.sh</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; while read ; do</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; sed -i.bak "s/EC002I001576/${ECOSYSTEM}/g" ${ORA2PG_HOME}/${ENV}/${ASSET}/${ASSET}${ENV}.sh</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; sed -i.bak "s/&lt;instance&gt;/${SERVER}/g" ${ORA2PG_HOME}/${ENV}/${ASSET}/${ASSET}${ENV}.sh</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; sed -i.bak "s/ENV/${ENV}/g" ${ORA2PG_HOME}/${ENV}/${ASSET}/${ASSET}${ENV}.sh</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; sed -i.bak "s/ASSET/${ASSET}/g" ${ORA2PG_HOME}/${ENV}/${ASSET}/${ASSET}${ENV}.sh</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; done &lt; ${ORA2PG_HOME}/${ENV}/${ASSET}/${ASSET}${ENV}.sh</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; cp ${ORA2PG_HOME}/adm/sh/template_launcher.sql &nbsp;${ORA2PG_HOME}/${ENV}/${ASSET}/launcher${ENV}.sql</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; while read ; do</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; sed -i.bak "s/ENV/${ENV}/g" ${ORA2PG_HOME}/${ENV}/${ASSET}/launcher${ENV}.sql</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; done &nbsp;&lt; ${ORA2PG_HOME}/${ENV}/${ASSET}/launcher${ENV}.sql</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; fi</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; if [[ "$VAULT_ADDR" == &lt;url_hors_prod&gt; ]]</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; then</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; ENV="nonprod"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; cat &nbsp;$ORA2PG_HOME/adm/sh/nonprod</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo " "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo "Give the name of the ecosystem :"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; read ECOSYSTEM</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; SERVER=$(cat $ORA2PG_HOME/adm/sh/nonprod | grep -i $ECOSYSTEM | &nbsp;awk &nbsp;'{print $4}')</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo " "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo "Give the name of the instance :"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo " "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo "$SERVER"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo " "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; read SERVER.</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; ASSET=$(cat $ORA2PG_HOME/adm/sh/nonprod | grep -i $SERVER | &nbsp;awk &nbsp;'{print $1}')</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; APREFI=$(cat $ORA2PG_HOME/adm/sh/nonprod | grep -i $SERVER | &nbsp;awk &nbsp;'{print $6}')</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; SOUSENV=$(cat $ORA2PG_HOME/adm/sh/nonprod | grep -i $SERVER | &nbsp;awk &nbsp;'{print $2}')</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo " "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo " The database is : $ASSET"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo " "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo " The Env is : $SOUSENV"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo " "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo " The deployment is on progress..."</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; ENVDIR="$ORA2PG_HOME/$ENV/$SOUSENV/$ASSET"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; mkdir -p $ENVDIR</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; cp ${ORA2PG_HOME}/adm/sh/template.sh ${ORA2PG_HOME}/${ENV}/${SOUSENV}/${ASSET}/${ASSET}${SOUSENV}.sh</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; while read ; do</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; sed -i.bak "s/&lt;ecosystem&gt;/${ECOSYSTEM}/g" ${ORA2PG_HOME}/${ENV}/${SOUSENV}/${ASSET}/${ASSET}${SOUSENV}.sh</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; sed -i.bak "s/&lt;instance&gt;/${SERVER}/g" ${ORA2PG_HOME}/${ENV}/${SOUSENV}/${ASSET}/${ASSET}${SOUSENV}.sh</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; sed -i.bak "s/ENV/${SOUSENV}/g" ${ORA2PG_HOME}/${ENV}/${SOUSENV}/${ASSET}/${ASSET}${SOUSENV}.sh</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; sed -i.bak "s/ASSET/${ASSET}/g" ${ORA2PG_HOME}/${ENV}/${SOUSENV}/${ASSET}/${ASSET}${SOUSENV}.sh</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; done &lt; ${ORA2PG_HOME}/${ENV}/${SOUSENV}/${ASSET}/${ASSET}${SOUSENV}.sh</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; fi</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; cp ${ORA2PG_HOME}/adm/sh/template_launcher.sql &nbsp;${ORA2PG_HOME}/${ENV}/${SOUSENV}/${ASSET}/launcher${SOUSENV}.sql</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; while read ; do</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; sed -i.bak "s/ENV/${SOUSENV}/g" ${ORA2PG_HOME}/${ENV}/${SOUSENV}/${ASSET}/launcher${SOUSENV}.sql</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; done &nbsp;&lt; ${ORA2PG_HOME}/${ENV}/${SOUSENV}/${ASSET}/launcher${SOUSENV}.sql</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; #creation of the specific privs for dev users</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp;if [[ "$SOUSENV" == dev ]]</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; then</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; touch devpg/devpg_${ASSET}.sql</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo "create user devpg password 'xxxxxxxxxx';"&gt;devpg/devpg_${ASSET}.sql</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo "GRANT CREATE ON DATABASE &lt;cloudDBname&gt; TO devpg;"&gt;&gt;devpg/devpg_${ASSET}.sql</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo "GRANT USAGE,CREATE ON SCHEMA own_${APREFI}_${ASSET} TO devpg;"&gt;&gt;devpg/devpg_${ASSET}.sql</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo "GRANT SELECT,UPDATE,INSERT,DELETE ON ALL TABLES IN SCHEMA own_${APREFI}_${ASSET} TO devpg;"&gt;&gt;devpg/devpg_${ASSET}.sql</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo "GRANT USAGE ON ALL SEQUENCES IN SCHEMA own_${APREFI}_${ASSET} TO devpg;"&gt;&gt;devpg/devpg_${ASSET}.sql</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo "GRANT EXECUTE ON ALL FUNCTIONS in SCHEMA own_${APREFI}_${ASSET} TO devpg;"&gt;&gt;devpg/devpg_${ASSET}.sql</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo "GRANT role_own_${APREFI}_${ASSET} to devpg;"&gt;&gt;devpg/devpg_${ASSET}.sql</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo "ALTER ROLE devpg SET search_path TO own_${APREFI}_${ASSET};"&gt;&gt;devpg/devpg_${ASSET}.sql</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo " "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo " Execute the script ${ORA2PG_HOME}/hvault/devpg/devpg_${ASSET}.sql to create the dev user."</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo " "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp;fi</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; echo "!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; echo "!!! The script ${ASSET}.sh &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; !!! "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; echo "!!! is deployed under $ENVDIR !!! "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; echo "!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; echo " The log is : log/${ASSET}.log &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; echo " To read the role :"&gt;&gt;log/${ASSET}.log</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; echo " vault read -ns="$VAULT_NAMESPACE/$ECOSYSTEM" database/postgres/${SERVER}/creds/${ROLE}"&gt;&gt;log/${ASSET}.log</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; echo " To delete the role execute : "&gt;&gt;log/${ASSET}.log</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; echo "vault delete -ns=$VAULT_NAMESPACE/$ECOSYSTEM database/postgres/$SERVER/roles/${ROLE}"&gt;&gt;log/${ASSET}.log</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; echo " "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; echo "Press enter to continue or ctrl C to quit"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; read bidon</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; #rm -f $.bak to do</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; ;;</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; q)</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; echo "Thanks, bye."</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; exit</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; ;;</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; *)</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; echo "Wrong value."</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; echo "Press enter to continue."</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; read bidon</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; ;;</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp;esac</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp;else</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">clear</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">echo " "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">echo " Welcome to the program of the deployment of $1 - dMZR"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">echo " "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">echo " "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">echo " 1 - Create a new role"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">echo " 2 - Deploy the script of connection"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">echo " q - Quit."</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">echo " "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">read var</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp;case $var in</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; 1)</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; clear</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo " "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; if [[ "$VAULT_ADDR" == &lt;url_prod&gt; ]]</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; then</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; ENV="prod"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DOMAIN=".svc.paas.echonet"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; cat $ORA2PG_HOME/adm/sh/prod</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo " "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo "Give the name of the ecosystem :"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; read ECOSYSTEM</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; SERVER=$(cat $ORA2PG_HOME/adm/sh/prod | grep -i $ECOSYSTEM | &nbsp;awk &nbsp;'{print $4}')</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo "Give the name of the instance :"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo "$SERVER"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo " "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; read SERVER</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo " "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; ASSET=$(cat $ORA2PG_HOME/adm/sh/prod | grep -i $SERVER | &nbsp;awk &nbsp;'{print $1}')</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; APREFI=$(cat $ORA2PG_HOME/adm/sh/prod | grep -i $SERVER | &nbsp;awk &nbsp;'{print $6}')</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PORT=$(cat $ORA2PG_HOME/adm/sh/prod | grep -i $SERVER | &nbsp;awk &nbsp;'{print $5}')</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo " "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo " Give the type of account to create (dba|own|app|dyn) :"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; read TYPE</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo " "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo " The database is : $ASSET"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo " "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; ENVDIR="$ORA2PG_HOME/$ENV/$ASSET"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; else</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if [[ "$VAULT_ADDR" == &lt;url_hors_prod&gt; ]]</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;then</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ENV="nonprod"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;DOMAIN=".svc-np.paas.echonet"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;cat &nbsp;$ORA2PG_HOME/adm/sh/nonprod</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;echo " "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;echo "Give the name of the ecosystem :"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;read ECOSYSTEM</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;SERVER=$(cat $ORA2PG_HOME/adm/sh/nonprod | grep -i $ECOSYSTEM | &nbsp;awk &nbsp;'{print $4}')</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;echo "Give the name of the instance :"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;echo "$SERVER"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;echo " "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;read SERVER</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ASSET=$(cat $ORA2PG_HOME/adm/sh/nonprod | grep -i $SERVER | &nbsp;awk &nbsp;'{print $1}')</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;APREFI=$(cat $ORA2PG_HOME/adm/sh/nonprod | grep -i $SERVER | &nbsp;awk &nbsp;'{print $6}')</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;SOUSENV=$(cat $ORA2PG_HOME/adm/sh/nonprod | grep -i $SERVER | &nbsp;awk &nbsp;'{print $2}')</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;PORT=$(cat $ORA2PG_HOME/adm/sh/nonprod | grep -i $SERVER | &nbsp;awk &nbsp;'{print $5}')</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;echo " "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;echo " Give the type of account to create (dba|own|app|dyn) :"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;read TYPE</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;echo " "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;echo " The environment of non prod is : $SOUSENV"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;echo " The database is : $ASSET"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;echo " "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ENVDIR="$ORA2PG_HOME/$ENV/$SOUSENV/$ASSET"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;else</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;echo " Wrong environment "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;exit 1</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;fi</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; fi</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">mkdir -p $ENVDIR</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">if [[ "$TYPE" == dba ]]</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">then</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">STATIC_ROLE_NAME="dba_pg"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">echo " You are going to create the role : "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">echo " $STATIC_ROLE_NAME."</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">cat &lt;&lt;EOF&gt; /tmp/dynamic-creation-statements.sql</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">DO</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">$do$</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">BEGIN</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">IF NOT EXISTS (</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">SELECT</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">FROM pg_roles</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">WHERE rolname = '$STATIC_ROLE_NAME') THEN</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">CREATE ROLE "$STATIC_ROLE_NAME" LOGIN CREATEDB CREATEROLE PASSWORD '{{password}}';</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">END IF;</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">create role "{{name}}" with login createdb createrole password '{{password}}' CONNECTION LIMIT 5 VALID UNTIL '{{expiration}}' in role pg_monitor,pg_signal_backend,"ibm-cloud-base-user" ;</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">grant "{{name}}" to admin ;</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">IF NOT EXISTS (</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">SELECT FROM pg_catalog.pg_extension WHERE extname = 'pg_buffercache') THEN CREATE EXTENSION "pg_buffercache";</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">END IF;</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">IF NOT EXISTS (</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">SELECT FROM pg_catalog.pg_extension WHERE extname = 'pg_stat_statements') THEN CREATE EXTENSION "pg_stat_statements";</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">END IF;</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">IF NOT EXISTS (</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">SELECT FROM pg_catalog.pg_extension WHERE extname = 'pg_freespacemap') THEN CREATE EXTENSION "pg_freespacemap";</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">END IF;</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">IF NOT EXISTS (</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">SELECT FROM pg_catalog.pg_extension WHERE extname = 'pg_repack') THEN CREATE EXTENSION "pg_repack";</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">END IF;</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">IF NOT EXISTS (</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">SELECT FROM pg_catalog.pg_extension WHERE extname = 'pgstattuple') THEN CREATE EXTENSION "pgstattuple";</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">END IF;</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">END</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">$do$;</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">EOF</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">#creation of the revocation script for the temporary dynamic role</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">cat &lt;&lt;EOF&gt; /tmp/dynamic-revocation-statements.sql</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">REASSIGN OWNED BY "{{name}}" to "ibm-cloud-base-user";</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">DROP OWNED by "{{name}}" ;</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">DROP ROLE IF EXISTS "{{name}}" ;</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">EOF</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">#temporary dynamic role name used to transform the dynamic role to a static role</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">DYNAMIC_ROLE_NAME="tmp-$(head /dev/urandom | tr -dc a-z0-9 | head -c 13 ; echo '')"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">#creation of the temporary dynamic role</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">result=$(vault write -ns="$VAULT_NAMESPACE/$ECOSYSTEM" </span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; database/postgres/${SERVER}/roles/${DYNAMIC_ROLE_NAME} </span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; db_name=${SERVER} </span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; creation_statements=@/tmp/dynamic-creation-statements.sql </span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; revocation_statements=@/tmp/dynamic-revocation-statements.sql </span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; default_ttl=24h </span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; max_ttl=8d 2&gt;&amp;1)</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">#test if the creation of the dynamic role is successful</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">if [[ $(echo "$result" | grep 'Success!' | wc -l) -lt 1 &nbsp;]]; then</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; echo "Can't create temporary dynamic role ${DYNAMIC_ROLE_NAME}: $result"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; exit 1</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">fi</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">#read the creds of the dynamic role</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">result=$(vault read -ns="$VAULT_NAMESPACE/$ECOSYSTEM" </span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; database/postgres/${SERVER}/creds/${DYNAMIC_ROLE_NAME} 2&gt;&amp;1)</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">#test if the creds can be read</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">if [[ $(echo "$result" | grep 'lease_id' | wc -l) -lt 1 &nbsp;]]; then</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; echo "Can't execute SQL query: $result"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; exit 2</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">fi</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">echo "Role $DYNAMIC_ROLE_NAME succefully created in DB. You can now create a Vault static role named $STATIC_ROLE_NAME."</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">#delete the dynamic role</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">result=$(vault delete -ns="$VAULT_NAMESPACE/$ECOSYSTEM" </span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; database/postgres/${SERVER}/roles/${DYNAMIC_ROLE_NAME} 2&gt;&amp;1)</span><br /><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">if [[ $(echo "$result" | grep 'Success!' | wc -l) -lt 1 &nbsp;]]; then</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; echo "Can't delete temporary role ${DYNAMIC_ROLE_NAME}: $result"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">fi</span><br /><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">cat &lt;&lt;EOF&gt; /tmp/static-rotation-statement.sql</span><br /><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">ALTER ROLE "{{name}}" WITH PASSWORD '{{password}}';</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">EOF</span><br /><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">vault write -ns="$VAULT_NAMESPACE/$ECOSYSTEM" database/postgres/${SERVER}/static-roles/${STATIC_ROLE_NAME} </span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">db_name=${SERVER} </span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">creation_statements=@/tmp/dynamic-creation-statements.sql </span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">rotation_statements=@/tmp/static-rotation-statement.sql </span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">default_ttl=24h </span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">max_ttl=8d </span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">username=${STATIC_ROLE_NAME} </span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">rotation_period=12h</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">#creation of a sysdba role inside the database</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">touch $ENVDIR/sysdba_${SERVER}_${ASSET}.sql</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">echo "CREATE ROLE sysdba WITH LOGIN CREATEDB CREATEROLE PASSWORD 'xxxxxxxxxxxxx';"&gt;$ENVDIR/sysdba_${SERVER}_${ASSET}.sql</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">echo "GRANT CREATE ON DATABASE $1 TO sysdba;"&gt;&gt;$ENVDIR/sysdba_${SERVER}_${ASSET}.sql</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">echo "GRANT USAGE,CREATE ON SCHEMA own_${APREFI}_${ASSET} TO sysdba;"&gt;&gt;$ENVDIR/sysdba_${SERVER}_${ASSET}.sql</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">echo "GRANT SELECT,UPDATE,INSERT,DELETE ON ALL TABLES IN SCHEMA own_${APREFI}_${ASSET} TO sysdba;"&gt;&gt;$ENVDIR/sysdba_${SERVER}_${ASSET}.sql</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">echo "GRANT USAGE ON ALL SEQUENCES IN SCHEMA own_${APREFI}_${ASSET} TO sysdba;"&gt;&gt;$ENVDIR/sysdba_${SERVER}_${ASSET}.sql</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">echo "GRANT EXECUTE ON ALL FUNCTIONS in SCHEMA own_${APREFI}_${ASSET} TO sysdba;"&gt;&gt;$ENVDIR/sysdba_${SERVER}_${ASSET}.sql</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">echo "GRANT admin,"ibm-cloud-base-user",role_own_${APREFI}_${ASSET} TO sysdba;"&gt;&gt;$ENVDIR/sysdba_${SERVER}_${ASSET}.sql</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">echo "ALTER ROLE sysdba SET search_path TO own_${APREFI}_${ASSET};"&gt;&gt;$ENVDIR/sysdba_${SERVER}_${ASSET}.sql</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">echo "Role $STATIC_ROLE_NAME succefully created in $1."</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">echo " "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">echo "Role sysdba can be created from $ENVDIR/sysdba_${SERVER}_${ASSET}.sql."</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">echo " "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">echo "Press enter to create a new role or ctrl C to quit"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">read bidon</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">fi</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">if [[ "$TYPE" == own ]]</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">then</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">STATIC_ROLE_NAME="stat_${TYPE}_${APREFI}_${ASSET}"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">SCHE="own_${APREFI}_${ASSET}"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">DYN="app_${APREFI}_${ASSET}"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">DBO="role_${TYPE}_${APREFI}_${ASSET}"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">echo " You are going to create the role : "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">echo " $STATIC_ROLE_NAME."</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">cat &lt;&lt;EOF&gt; /tmp/static-creation-statements.sql</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">DO</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">$do$</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">BEGIN</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">IF NOT EXISTS (</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">SELECT</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">FROM pg_roles</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">WHERE rolname = '$STATIC_ROLE_NAME') THEN</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">CREATE ROLE "$STATIC_ROLE_NAME" LOGIN CREATEDB CREATEROLE PASSWORD '{{password}}';</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">END IF;</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">create role "{{name}}" with login createdb createrole password '{{password}}' CONNECTION LIMIT 5 VALID UNTIL '{{expiration}}' INHERIT;</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">grant "{{name}}" to admin ;</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">ALTER ROLE "{{name}}" set search_path to "$STATIC_ROLE_NAME";</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">IF NOT EXISTS (</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">SELECT FROM pg_catalog.pg_roles WHERE rolname ='$DBO') THEN</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">CREATE ROLE "$DBO" NOLOGIN;</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">GRANT "$DBO" TO admin;</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">-- rattachement du user stat_own_25640_wbfs au groupe role_own_25640_wbfs</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">GRANT "$DBO" TO "$STATIC_ROLE_NAME";</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">END IF;</span><br /><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">-- rajouter la section suivante pour les instances sur l’offre PostgreSQL mais pas pour les instances sur l’offre PostgreSQL EE car pour l’instant, une limitation sur cette offre ne permet pas de créer les extensions</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">IF NOT EXISTS (</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">SELECT FROM pg_catalog.pg_extension WHERE extname = 'pg_buffercache') THEN CREATE EXTENSION "pg_buffercache";</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">END IF;</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">IF NOT EXISTS (</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">SELECT FROM pg_catalog.pg_extension WHERE extname = 'pg_stat_statements') THEN CREATE EXTENSION "pg_stat_statements";</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">END IF;</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">IF NOT EXISTS (</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">SELECT FROM pg_catalog.pg_extension WHERE extname = 'pg_freespacemap') THEN CREATE EXTENSION "pg_freespacemap";</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">END IF;</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">IF NOT EXISTS (</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">SELECT FROM pg_catalog.pg_extension WHERE extname = 'pg_repack') THEN CREATE EXTENSION "pg_repack";</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">END IF;</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">IF NOT EXISTS (</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">SELECT FROM pg_catalog.pg_extension WHERE extname = 'pgstattuple') THEN CREATE EXTENSION "pgstattuple";</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">END IF;</span><br /><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">END</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">$do$;</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">EOF</span><br /><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">cat &lt;&lt;EOF&gt; /tmp/static-revocation-statements.sql</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">revoke admin from "{{name}}" ;</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">grant "{{name}}" to admin ;</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">REASSIGN OWNED BY "{{name}}" to "$DBO";</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">DROP OWNED by "{{name}}" ;</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">DROP ROLE IF EXISTS "{{name}}";</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">EOF</span><br /><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">DYNAMIC_ROLE_NAME="tmp-$(head /dev/urandom | tr -dc a-z0-9 | head -c 13 ; echo '')"</span><br /><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">result=$(vault write -ns="$VAULT_NAMESPACE/$ECOSYSTEM" </span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; database/postgres/${SERVER}/roles/${DYNAMIC_ROLE_NAME} </span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; db_name=${SERVER} </span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; creation_statements=@/tmp/static-creation-statements.sql </span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; revocation_statements=@/tmp/static-revocation-statements.sql </span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; default_ttl=24h </span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; max_ttl=8d 2&gt;&amp;1)</span><br /><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">if [[ $(echo "$result" | grep 'Success!' | wc -l) -lt 1 &nbsp;]]; then</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; echo "Can't create temporary dynamic role ${DYNAMIC_ROLE_NAME}: $result"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; exit 1</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">fi</span><br /><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">result=$(vault read -ns="$VAULT_NAMESPACE/$ECOSYSTEM" </span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; database/postgres/${SERVER}/creds/${DYNAMIC_ROLE_NAME} 2&gt;&amp;1)</span><br /><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">if [[ $(echo "$result" | grep 'lease_id' | wc -l) -lt 1 &nbsp;]]; then</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; echo "Can't execute SQL query: $result"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; exit 2</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">fi</span><br /><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">echo "Role $DYNAMIC_ROLE_NAME succefully created in DB. You can now create a Vault static role named $STATIC_ROLE_NAME."</span><br /><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">result=$(vault delete -ns="$VAULT_NAMESPACE/$ECOSYSTEM" </span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; database/postgres/${SERVER}/roles/${DYNAMIC_ROLE_NAME} 2&gt;&amp;1)</span><br /><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">if [[ $(echo "$result" | grep 'Success!' | wc -l) -lt 1 &nbsp;]]; then</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; echo "Can't delete temporary role ${DYNAMIC_ROLE_NAME}: $result"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">fi</span><br /><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">cat &lt;&lt;EOF&gt; /tmp/static-rotation-statement.sql</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">ALTER ROLE "{{name}}" WITH PASSWORD '{{password}}';</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">EOF</span><br /><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; vault write -ns="$VAULT_NAMESPACE/$ECOSYSTEM" database/postgres/${SERVER}/static-roles/${STATIC_ROLE_NAME} </span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; db_name=${SERVER} </span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; creation_statements=@/tmp/static-creation-statements.sql </span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; rotation_statements=@/tmp/static-rotation-statement.sql </span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; default_ttl=24h </span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; max_ttl=8d </span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; username=${STATIC_ROLE_NAME} </span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; rotation_period=12h</span><br /><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">secret=$(vault read -ns="$VAULT_NAMESPACE/$ECOSYSTEM" &nbsp;database/postgres/$SERVER/static-creds/$STATIC_ROLE_NAME | grep password | &nbsp;awk '{print $2}')</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">export PGPASSWORD=$secret;createdb $1 -O $DBO -h $SERVER$DOMAIN -p $PORT -U $STATIC_ROLE_NAME</span><br /><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">cat &lt;&lt;EOF&gt; /tmp/static-grant-statements.sql</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">DO</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">$do$</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">BEGIN</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">CREATE SCHEMA IF NOT EXISTS "$SCHE";</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">-- création du groupe &nbsp;s'il n'existe pas déjà, avec droit de se connecter au schéma&nbsp;</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">IF NOT EXISTS (</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">SELECT FROM pg_catalog.pg_roles WHERE rolname ='role_$DYN') THEN</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">CREATE ROLE "role_$DYN" NOLOGIN;</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">ALTER ROLE "role_$DYN" SET search_path TO "$SCHE";</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">GRANT USAGE ON SCHEMA "$SCHE" TO "role_$DYN";</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">END IF;</span><br /><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">ALTER SCHEMA "$SCHE" OWNER TO "$DBO";</span><br /><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">--don des droits de manipulation des objets du schéma au groupe&nbsp;</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">SET ROLE "$DBO";</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">-- Les ALTER DEFAULT PRIVILEGE doivent être exécutés par le créateur des objets</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">ALTER DEFAULT PRIVILEGES IN SCHEMA "$SCHE" GRANT SELECT,UPDATE,INSERT,DELETE ON TABLES TO role_$DYN;</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">ALTER DEFAULT PRIVILEGES IN SCHEMA "$SCHE" GRANT USAGE ON SEQUENCES TO role_$DYN;</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">ALTER DEFAULT PRIVILEGES IN SCHEMA "$SCHE" GRANT EXECUTE ON FUNCTIONS TO role_$DYN;</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">ALTER DEFAULT PRIVILEGES IN SCHEMA "$SCHE" GRANT USAGE ON TYPES TO role_$DYN;</span><br /><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">RESET ROLE;</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">-- Permet de se connecter directement avec le rôle chapeau (qui sera donc propriétaire des objets que vous créerez)</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">ALTER ROLE "$STATIC_ROLE_NAME" SET search_path TO "$STATIC_ROLE_NAME";</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">ALTER ROLE "$STATIC_ROLE_NAME" SET ROLE "$DBO";</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">END</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">$do$;</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">EOF</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">export PGPASSWORD=$secret;psql -h $SERVER$DOMAIN -p $PORT -U $STATIC_ROLE_NAME -d $1 -f /tmp/static-grant-statements.sql</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">echo " "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">echo "Database $1 succefully created."</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">echo " "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">echo "Role $STATIC_ROLE_NAME and schema $SCHE succefully created in $1."</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">echo " "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">echo "Press enter to create a new role or ctrl C to quit"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">read bidon</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">fi</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">if [[ "$TYPE" == app ]]</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">then</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">STATIC_ROLE_NAME="stat_${TYPE}_${APREFI}_${ASSET}"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">SCHE="own_${APREFI}_${ASSET}"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">DYN="app_${APREFI}_${ASSET}"</span><br /><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">echo " You are going to create the role : "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">echo " $STATIC_ROLE_NAME."</span><br /><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">cat &lt;&lt;EOF&gt; /tmp/statics-creation-statements.sql</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">DO</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">$do$</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">BEGIN</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">IF NOT EXISTS (</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">SELECT</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">FROM pg_roles</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">WHERE rolname = '$STATIC_ROLE_NAME') THEN</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">CREATE ROLE "$STATIC_ROLE_NAME" LOGIN PASSWORD '{{password}}';</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">END IF;</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">-- création du role dynamique</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">CREATE ROLE "{{name}}" WITH LOGIN PASSWORD '{{password}}' VALID UNTIL '{{expiration}}' INHERIT;</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">GRANT "{{name}}" TO admin;</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">-- rattachement du user &nbsp;au groupe &nbsp;(qui a été créé en même temps )</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">GRANT "role_$DYN" TO "{{name}}";</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">ALTER ROLE "{{name}}" SET search_path TO "$SCHE";</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">RESET ROLE;</span><br /><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">-- rajouter la section suivante pour les instances sur l’offre PostgreSQL mais pas pour les instances sur l’offre PostgreSQL EE car pour l’instant, une limitation sur cette offre ne permet pas de créer les extensions</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">IF NOT EXISTS (</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">SELECT FROM pg_catalog.pg_extension WHERE extname = 'pg_buffercache') THEN CREATE EXTENSION "pg_buffercache";</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">END IF;</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">IF NOT EXISTS (</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">SELECT FROM pg_catalog.pg_extension WHERE extname = 'pg_stat_statements') THEN CREATE EXTENSION "pg_stat_statements";</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">END IF;</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">IF NOT EXISTS (</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">SELECT FROM pg_catalog.pg_extension WHERE extname = 'pg_freespacemap') THEN CREATE EXTENSION "pg_freespacemap";</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">END IF;</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">IF NOT EXISTS (</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">SELECT FROM pg_catalog.pg_extension WHERE extname = 'pg_repack') THEN CREATE EXTENSION "pg_repack";</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">END IF;</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">IF NOT EXISTS (</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">SELECT FROM pg_catalog.pg_extension WHERE extname = 'pgstattuple') THEN CREATE EXTENSION "pgstattuple";</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">END IF;</span><br /><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">END</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">$do$;</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">EOF</span><br /><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">cat &lt;&lt;EOF&gt; /tmp/statics-revocation-statements.sql</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">revoke admin from "{{name}}" ;</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">grant "{{name}}" to admin ;</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">REASSIGN OWNED BY "{{name}}" to role_$DYN;</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">DROP OWNED by "{{name}}" ;</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">DROP ROLE IF EXISTS "{{name}}";</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">EOF</span><br /><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">DYNAMIC_ROLE_NAME="tmp-$(head /dev/urandom | tr -dc a-z0-9 | head -c 13 ; echo '')"</span><br /><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">result=$(vault write -ns="$VAULT_NAMESPACE/$ECOSYSTEM" </span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; database/postgres/${SERVER}/roles/${DYNAMIC_ROLE_NAME} </span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; db_name=${SERVER} </span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; creation_statements=@/tmp/statics-creation-statements.sql </span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; revocation_statements=@/tmp/statics-revocation-statements.sql </span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; default_ttl=24h </span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; max_ttl=8d 2&gt;&amp;1)</span><br /><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">if [[ $(echo "$result" | grep 'Success!' | wc -l) -lt 1 &nbsp;]]; then</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; echo "Can't create temporary dynamic role ${DYNAMIC_ROLE_NAME}: $result"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; exit 1</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">fi</span><br /><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">result=$(vault read -ns="$VAULT_NAMESPACE/$ECOSYSTEM" </span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; database/postgres/${SERVER}/creds/${DYNAMIC_ROLE_NAME} 2&gt;&amp;1)</span><br /><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">if [[ $(echo "$result" | grep 'lease_id' | wc -l) -lt 1 &nbsp;]]; then</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; echo "Can't execute SQL query: $result"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; exit 2</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">fi</span><br /><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">echo "Role $DYNAMIC_ROLE_NAME succefully created in DB. You can now create a Vault static role named $STATIC_ROLE_NAME."</span><br /><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">result=$(vault delete -ns="$VAULT_NAMESPACE/$ECOSYSTEM" </span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">database/postgres/${SERVER}/roles/${DYNAMIC_ROLE_NAME} 2&gt;&amp;1)</span><br /><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">if [[ $(echo "$result" | grep 'Success!' | wc -l) -lt 1 &nbsp;]]; then</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; echo "Can't delete temporary role ${DYNAMIC_ROLE_NAME}: $result"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">fi</span><br /><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">cat &lt;&lt;EOF&gt; /tmp/statics-rotation-statement.sql</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">ALTER ROLE "{{name}}" WITH PASSWORD '{{password}}';</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">EOF</span><br /><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">vault write -ns="$VAULT_NAMESPACE/$ECOSYSTEM" database/postgres/${SERVER}/static-roles/${STATIC_ROLE_NAME} </span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">db_name=${SERVER} </span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">creation_statements=@/tmp/statics-creation-statements.sql </span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">rotation_statements=@/tmp/statics-rotation-statement.sql </span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">default_ttl=24h </span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">max_ttl=8d </span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">username=${STATIC_ROLE_NAME} </span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">rotation_period=12h</span><br /><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">echo "Role $STATIC_ROLE_NAME succefully created in $1."</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">echo " "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">echo "Press enter to create a new role or ctrl C to quit"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">read bidon</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">fi</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">if [[ "$TYPE" == dyn ]]</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">then</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">SCHE="own_${APREFI}_${ASSET}"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">GRP="role_app_${APREFI}_${ASSET}"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">DYN="dyn_app_${APREFI}_${ASSET}"</span><br /><br /><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">echo " You are going to create the role : "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">echo " $DYN."</span><br /><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">cat &lt;&lt;EOF&gt; /tmp/dyn-creation-statements.sql</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">DO</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">$do$</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">BEGIN</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">-- création du role dynamique</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">CREATE ROLE "{{name}}" LOGIN PASSWORD '{{password}}' VALID UNTIL '{{expiration}}' INHERIT;</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">GRANT "{{name}}" TO admin;</span><br /><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">-- rattachement du user &nbsp;au groupe &nbsp;(qui a été créé en même temps )</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">GRANT $GRP TO "{{name}}";</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">ALTER ROLE "{{name}}" SET search_path TO "$SCHE";</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">RESET ROLE;</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">ALTER ROLE "{{name}}" SET ROLE "$GRP";</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">--Permet de se connecter directement avec le rôle chapeau (qui sera donc propriétaire des objets que vous créerez)</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">END</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">$do$;</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">EOF</span><br /><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">cat &lt;&lt;EOF&gt; /tmp/dyn-revocation-statements.sql</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; revoke admin from "{{name}}" ;</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; grant "{{name}}" to admin ;</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; REASSIGN OWNED BY "{{name}}" to $GRP;</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; DROP OWNED by "{{name}}" ;</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; DROP ROLE IF EXISTS "{{name}}";</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">EOF</span><br /><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">vault write -ns="$VAULT_NAMESPACE/$ECOSYSTEM" </span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; database/postgres/${SERVER}/roles/${DYN} </span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; db_name=${SERVER} </span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; creation_statements=@/tmp/dyn-creation-statements.sql </span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; revocation_statements=@/tmp/dyn-revocation-statements.sql </span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; default_ttl=24h </span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; max_ttl=8d 2&gt;&amp;1</span><br /><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; echo " "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; echo "!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; echo "!!! The role ${DYN} is created in $1!!! "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; echo "!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; echo " "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; echo "Press enter to create a new role or ctrl C to quit"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; read bidon</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">fi</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; ;;</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; 2)</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; clear</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo " "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; if [[ "$VAULT_ADDR" == &lt;url_prod&gt; ]]</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; then</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; ENV="prod"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; cat &nbsp;$ORA2PG_HOME/adm/sh/prod</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo " "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo "Give the name of the ecosystem :"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; read ECOSYSTEM</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; SERVER=$(cat $ORA2PG_HOME/adm/sh/prod | grep -i $ECOSYSTEM | &nbsp;awk &nbsp;'{print $4}')</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo " "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo "Give the name of the instance:"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo "$SERVER"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo " "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; read SERVER</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo " "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; ASSET=$(cat $ORA2PG_HOME/adm/sh/prod | grep -i $SERVER | &nbsp;awk &nbsp;'{print $1}')</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo " "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo " The database is : $ASSET"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo " "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo " The Env is : $ENV"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo " "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo " The deployment is on progress..."</span><br /><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; ENVDIR="$ORA2PG_HOME/$ENV/$ASSET"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; mkdir -p $ENVDIR</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; cp ${ORA2PG_HOME}/adm/sh/template-static.sh ${ORA2PG_HOME}/${ENV}/${ASSET}/${ASSET}${ENV}.sh</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; while read ; do</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; sed -i.bak "s/&lt;ecosystem&gt;/${ECOSYSTEM}/g" ${ORA2PG_HOME}/${ENV}/${ASSET}/${ASSET}${ENV}.sh</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; sed -i.bak "s/&lt;instance&gt;/${SERVER}/g" ${ORA2PG_HOME}/${ENV}/${ASSET}/${ASSET}${ENV}.sh</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sed -i.bak "s/mydb/$1/g" ${ORA2PG_HOME}/${ENV}/${ASSET}/${ASSET}${ENV}.sh</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; sed -i.bak "s/ENV/${ENV}/g" ${ORA2PG_HOME}/${ENV}/${ASSET}/${ASSET}${ENV}.sh</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; sed -i.bak "s/ASSET/${ASSET}/g" ${ORA2PG_HOME}/${ENV}/${ASSET}/${ASSET}${ENV}.sh</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; done &lt; ${ORA2PG_HOME}/${ENV}/${ASSET}/${ASSET}${ENV}.sh</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; cp ${ORA2PG_HOME}/adm/sh/template_launcher.sql &nbsp;${ORA2PG_HOME}/${ENV}/${ASSET}/launcher${ENV}.sql</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; while read ; do</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; sed -i.bak "s/ENV/${ENV}/g" ${ORA2PG_HOME}/${ENV}/${ASSET}/launcher${ENV}.sql</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; done &nbsp;&lt; ${ORA2PG_HOME}/${ENV}/${ASSET}/launcher${ENV}.sql</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; fi</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; if [[ "$VAULT_ADDR" == &lt;url_hors_prod&gt; ]]</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; then</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; ENV="nonprod"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; cat &nbsp;$ORA2PG_HOME/adm/sh/nonprod</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo " "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo "Give the name of the ecosystem :"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; read ECOSYSTEM</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; SERVER=$(cat $ORA2PG_HOME/adm/sh/nonprod | grep -i $ECOSYSTEM | &nbsp;awk &nbsp;'{print $4}')</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo " "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo "Give the name of the instance :"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo " "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo "$SERVER"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo " "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; read SERVER</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; ASSET=$(cat $ORA2PG_HOME/adm/sh/nonprod | grep -i $SERVER | &nbsp;awk &nbsp;'{print $1}')</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; APREFI=$(cat $ORA2PG_HOME/adm/sh/nonprod | grep -i $SERVER | &nbsp;awk &nbsp;'{print $6}')</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; SOUSENV=$(cat $ORA2PG_HOME/adm/sh/nonprod | grep -i $SERVER | &nbsp;awk &nbsp;'{print $2}')</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo " "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo " The database is : $ASSET"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo " "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo " The Env is : $SOUSENV"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo " "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo " The deployment is on progress..."</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; ENVDIR="$ORA2PG_HOME/$ENV/$SOUSENV/$ASSET"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; mkdir -p $ENVDIR</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; cp ${ORA2PG_HOME}/adm/sh/template-static.sh ${ORA2PG_HOME}/${ENV}/${SOUSENV}/${ASSET}/${ASSET}${SOUSENV}.sh</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; while read ; do</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; sed -i.bak "s/&lt;ecosystem&gt;/${ECOSYSTEM}/g" ${ORA2PG_HOME}/${ENV}/${SOUSENV}/${ASSET}/${ASSET}${SOUSENV}.sh</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; sed -i.bak "s/&lt;instance&gt;/${SERVER}/g" ${ORA2PG_HOME}/${ENV}/${SOUSENV}/${ASSET}/${ASSET}${SOUSENV}.sh</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sed -i.bak "s/mydb/$1/g" ${ORA2PG_HOME}/${ENV}/${SOUSENV}/${ASSET}/${ASSET}${SOUSENV}.sh</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; sed -i.bak "s/ENV/${SOUSENV}/g" ${ORA2PG_HOME}/${ENV}/${SOUSENV}/${ASSET}/${ASSET}${SOUSENV}.sh</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; sed -i.bak "s/ASSET/${ASSET}/g" ${ORA2PG_HOME}/${ENV}/${SOUSENV}/${ASSET}/${ASSET}${SOUSENV}.sh</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; done &lt; ${ORA2PG_HOME}/${ENV}/${SOUSENV}/${ASSET}/${ASSET}${SOUSENV}.sh</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; fi</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; cp ${ORA2PG_HOME}/adm/sh/template_launcher.sql &nbsp;${ORA2PG_HOME}/${ENV}/${SOUSENV}/${ASSET}/launcher${SOUSENV}.sql</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; while read ; do</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; sed -i.bak "s/ENV/${SOUSENV}/g" ${ORA2PG_HOME}/${ENV}/${SOUSENV}/${ASSET}/launcher${SOUSENV}.sql</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; done &nbsp;&lt; ${ORA2PG_HOME}/${ENV}/${SOUSENV}/${ASSET}/launcher${SOUSENV}.sql</span><br /><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp;if [[ "$SOUSENV" == dev ]]</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; then</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; touch &lt;userdev&gt;/&lt;userdev&gt;_${ASSET}.sql</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo "create user &lt;userdev&gt; password 'xxxxxxxxxx';"&gt;&lt;userdev&gt;/&lt;userdev&gt;_${ASSET}.sql</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo "GRANT CREATE ON DATABASE $1 TO &lt;userdev&gt;;"&gt;&gt;&lt;userdev&gt;/&lt;userdev&gt;_${ASSET}.sql</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo "GRANT USAGE,CREATE ON SCHEMA own_${APREFI}_${ASSET} TO &lt;userdev&gt;;"&gt;&gt;&lt;userdev&gt;/&lt;userdev&gt;_${ASSET}.sql</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo "GRANT SELECT,UPDATE,INSERT,DELETE ON ALL TABLES IN SCHEMA own_${APREFI}_${ASSET} TO &lt;userdev&gt;;"&gt;&gt;&lt;userdev&gt;/&lt;userdev&gt;_${ASSET}.sql</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo "GRANT USAGE ON ALL SEQUENCES IN SCHEMA own_${APREFI}_${ASSET} TO &lt;userdev&gt;;"&gt;&gt;&lt;userdev&gt;/&lt;userdev&gt;_${ASSET}.sql</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo "GRANT EXECUTE ON ALL FUNCTIONS in SCHEMA own_${APREFI}_${ASSET} TO &lt;userdev&gt;;"&gt;&gt;&lt;userdev&gt;/&lt;userdev&gt;_${ASSET}.sql</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo "GRANT role_own_${APREFI}_${ASSET} to &lt;userdev&gt;;"&gt;&gt;&lt;userdev&gt;/&lt;userdev&gt;_${ASSET}.sql</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo "ALTER ROLE &lt;userdev&gt; SET search_path TO own_${APREFI}_${ASSET};"&gt;&gt;&lt;userdev&gt;/&lt;userdev&gt;_${ASSET}.sql</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo " "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo " Execute the script ${ORA2PG_HOME}/hvault/&lt;userdev&gt;/&lt;userdev&gt;_${ASSET}.sql to create the dev user."</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp; &nbsp; echo " "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; &nbsp;fi</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; echo "!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; echo "!!! The script ${ASSET}.sh &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; !!! "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; echo "!!! is deployed under $ENVDIR !!! "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; echo "!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; echo " The log is : log/${ASSET}.log &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; echo " To read the role :"&gt;&gt;log/${ASSET}.log</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; echo " vault read -ns="$VAULT_NAMESPACE/$ECOSYSTEM" database/postgres/${SERVER}/creds/${ROLE}"&gt;&gt;log/${ASSET}.log</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; echo " To delete the role execute : "&gt;&gt;log/${ASSET}.log</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; echo "vault delete -ns=$VAULT_NAMESPACE/$ECOSYSTEM database/postgres/$SERVER/roles/${ROLE}"&gt;&gt;log/${ASSET}.log</span><br /><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; echo " "</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; echo "Press enter to continue or ctrl C to quit"</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; read bidon</span><br /><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; #rm -f les .bak</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; ;;</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; q)</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; echo "Thanks, bye."</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; exit</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; ;;</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; *)</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; echo "Wrong value."</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; echo "Press enter to continue."</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; read bidon</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp; &nbsp; ;;</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">&nbsp;esac</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">fi</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">done</span><br /><span style="font-family: 'courier new', courier, monospace; font-size: 8pt;">exit 0</span></pre>
</section>
<section class="article-bottom">
<div><!-- start post 3 --><span class="box-article-link box-article-facebook-share">
<a href="http://www.facebook.com/share.php?u=http%3A%2F%2Flefetard.hautetfort.com%2Farchive%2F2022%2F12%2F05%2Fdeploy-new-postgresql-instance-dmzr-6415415.html&amp;t=Deploy+new+postgreSQL+instance+dMZR" target="_blank" rel="nofollow">
<span class="icon icon-facebook"></span>
<span class="social-action">Share</span>
</a>
</span><span class="box-article-link box-article-permalink">
<a href="deploy-new-postgresql-instance-dmzr-6415415.html" id="a"><i class="icon icon-link"></i> Lien permanent</a>
</span><!-- widget categories on -->
<span class="box-article-link box-article-categories">Catégories : <a href="cloud-db">Cloud db</a>, <a href="postgresql">Postgresql</a>, <a href="professionnel">Professionnel</a></span><!-- widget categories off --><!-- widget tags on -->
<!-- widget tags off --><span class="box-article-link box-article-comments">
<a href="deploy-new-postgresql-instance-dmzr-6415415.html#article-comments" rel="nofollow">
<span class="article-comments-pre"></span>
<span class="article-comments-count">0</span>&nbsp;<span class="article-comments-post">commentaire</span>
</a>
</span>
<!-- end post 3 --></div>
</section>
<footer class="box-footer">
<p>Les commentaires sont fermés.</p>
</footer>
</article>
<!-- widget article off --></div>
</section>
</main>
</div>
</div>
</div>
</div>
<footer class="footer-main" role="contentinfo" itemscope="itemscope" itemtype="http://schema.org/WPFooter">
<div class="main-inner">
<!-- start bottom --><div class="row-fluid"><div class="span6"><!-- widget heading on -->
<div class="box box-heading" id="box-heading-101347">
<div class="box-header">
<h1><a href="index-0.html">The Best of DBA</a></h1>
</div>
<div class="box-body">
<h2>Maîtriser les bases de données, maximiser les performances.</h2>
</div>
</div>
<!-- widget heading off --></div><div class="span6"><!-- widget sharing on -->
<div class="box box-sharing" id="box-sharing-101349">
<div class="box-body">
<ul role="list" class="sharing-list">
<li role="listitem"><a href="index.php" title="Email"><span class="icon-container"><i class="icon icon-envelope"></i><span class="mask-text">Email</span></span></a></li>
</ul>
</div>
</div>
<!-- widget sharing off --></div></div><!-- end bottom --></div>
</footer>
</div>
</div>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.3.1/jquery.cookie.js"></script>
<script src="http://ajax.aspnetcdn.com/ajax/jquery.validate/1.11.1/jquery.validate.min.js"></script>
<script src="http://ajax.aspnetcdn.com/ajax/jquery.validate/1.11.1/localization/messages_fr.js"></script><script src="bs.js"></script>
<!--[if (gte IE 6)&(lte IE 8)]>
<script src="https://static.hautetfort.com/backend/javascript/front/selectivizr-min.js"></script>
<![endif]-->
<!--[if lte IE 9]>
<script src="https://static.hautetfort.com/backend/javascript/front/jquery.placeholder.js"></script>
<script>
jQuery('input, textarea').placeholder();
</script>
<![endif]-->
<!-- start script -->
<script>
(function() {
var po = document.createElement('script'); po.async = true;
po.src = 'https://apis.google.com/js/plusone.js?onload=onLoadCallback';
var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
})();
</script>
<!-- end script --><script>
if(typeof jQuery == 'function' && jQuery('div[data-cookie]').length) {
  jQuery('p[data-close] a').on('click', function (event) {
    event.preventDefault();
    jQuery('div[data-cookie]').attr('data-cookie', 'off');
    var d = new Date();
    d.setTime(d.getTime() + (86400000 * 365));
    document.cookie = 'cookies_message=hide; expires=' + d.toGMTString() + '; path=/';
  });
} else if(typeof $$ == 'function' && $$('div[data-cookie]').length) {
  $$('p[data-close] a')[0].observe('click', function (event) {
    event.preventDefault();
    $$('div[data-cookie]')[0].setAttribute('data-cookie', 'off');
    var d = new Date();
    d.setTime(d.getTime() + (86400000 * 365));
    document.cookie = 'cookies_message=hide; expires=' + d.toGMTString() + '; path=/';
  });
}
if (!document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*cookies_message\\s*\\=\\s*([^;]*).*$)|^.*$"), "$1")) {
  if(typeof jQuery == 'function') {
    jQuery('div[data-cookie]').attr('data-cookie', 'on');
  } else if(typeof $$ == 'function') {
    $$('div[data-cookie]')[0].setAttribute('data-cookie', 'on');
  }
}
</script>
    
    <input type='hidden' id='_videoStepTitleText+11' value=' Videos We Recommend' /><input type='hidden' id='_videoStepTitleStyle+11' value='font-family:Arial, Helvetica Neue, Helvetica, sans-serif;font-size: 16px;color: #FFFFFF;text-align: center;font-weight: normal;font-style: normal;text-decoration: none;' /><input type='hidden' id='_videoStepBackgroundColor+11' value='#404d55' /><input type='hidden' id='_videoStepHasBorder+11' value='True' /><input type='hidden' id='_videoStepCountry+11' value='FR' /><input type='hidden' id='_videoStepScriptType' value='3' /><div id='divVideoStep+11' class='divVideoStep'></div><script type='text/javascript'>(function (){var vs = document.createElement('script'); vs.type = 'text/javascript';vs.async = true;vs.src = 'http://kweb.videostep.com/GetLink';var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(vs, s);})();</script>
    <input type='hidden' id='_videoStepPublisherId' value='111' />
    
    <div id="footer">
    <a href="http://www.hautetfort.com/create_account.php">Créer un blog</a> sur <a href="http://www.hautetfort.com/">Hautetfort</a>
    <br />
    <a href="http://www.hautetfort.com/explore/blogs">Les derniers blogs mis à jour</a>&nbsp;|
    <a href="http://www.hautetfort.com/explore/posts">Les dernières notes publiées</a>&nbsp;|
    <a href="http://www.hautetfort.com/explore/posts/tags">Les tags les plus populaires</a>
    <br />
    <a href="http://www.hautetfort.com/moderate.php?blog_url=http%3A%2F%2Flefetard.hautetfort.com%2F">Déclarer un contenu illicite</a>&nbsp;|
    <a href="mentions-legales.html">Mentions légales de ce blog</a>
    &nbsp;|
    <a href="http://www.hautetfort.com/">Hautetfort</a> est une marque déposée de la société talkSpirit
    &nbsp;|
    Créez votre <a href="http://www.hautetfort.com/">blog</a> !
    </div>
        
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-351048-6']);
  _gaq.push(['_trackPageview']);
_gaq.push(['_trackEvent', 'Free plan', 'Rencontres, Amour', 'lefetard.hautetfort.com']);
_gaq.push(['_trackEvent', 'Free plan1', 'MultiCategories', 'lefetard.hautetfort.com']);


  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</body>
</html>